{"remainingRequest":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/babel-loader@8.4.1_@babel+core@7.28.5_webpack@4.47.0/node_modules/babel-loader/lib/index.js!/Users/tbw/work/btProject/reaction-cut/frontend/src/utils/bilibiliInterceptor.js","dependencies":[{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/src/utils/bilibiliInterceptor.js","mtime":1761977317277},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/babel-loader@8.4.1_@babel+core@7.28.5_webpack@4.47.0/node_modules/babel-loader/lib/index.js","mtime":1761026722096}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gQmlsaWJpbGkgQVBJ5oum5oiq5ZmoCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBCaWxpYmlsaUF1dGggZnJvbSAnLi9iaWxpYmlsaUF1dGgnOwoKLy8g5Yib5bu6YXhpb3Plrp7kvosKY29uc3QgYmlsaWJpbGlBcGkgPSBheGlvcy5jcmVhdGUoewogIGJhc2VVUkw6ICcvYXBpJywKICAvLyDkvb/nlKjku6PnkIbpgb/lhY3ot6jln5/pl67popgKICB0aW1lb3V0OiAxMDAwMAp9KTsKCi8vIOivt+axguaLpuaIquWZqApiaWxpYmlsaUFwaS5pbnRlcmNlcHRvcnMucmVxdWVzdC51c2UoY29uZmlnID0+IHsKICAvLyDmo4Dmn6XmmK/lkKbpnIDopoHorqTor4EKICBpZiAoY29uZmlnLm5lZWRBdXRoKSB7CiAgICBjb25zdCBsb2dpbkluZm8gPSBCaWxpYmlsaUF1dGguZ2V0TG9naW5JbmZvKCk7CiAgICBpZiAobG9naW5JbmZvICYmIGxvZ2luSW5mby5kYXRhKSB7CiAgICAgIC8vIOS7jueZu+W9leS/oeaBr+S4reaPkOWPlmNvb2tpZeW5tua3u+WKoOWIsOivt+axguWktAogICAgICBjb25zdCBjb29raWVzID0gZXh0cmFjdENvb2tpZXNGcm9tTG9naW5JbmZvKGxvZ2luSW5mby5kYXRhKTsKICAgICAgaWYgKGNvb2tpZXMpIHsKICAgICAgICBjb25maWcuaGVhZGVyc1snQ29va2llJ10gPSBjb29raWVzOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiBjb25maWc7Cn0sIGVycm9yID0+IHsKICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwp9KTsKCi8vIOS7jueZu+W9leS/oeaBr+S4reaPkOWPlkNvb2tpZQpmdW5jdGlvbiBleHRyYWN0Q29va2llc0Zyb21Mb2dpbkluZm8obG9naW5EYXRhKSB7CiAgdHJ5IHsKICAgIC8vIOagueaNruWunumZheeahOeZu+W9leWTjeW6lOe7k+aehOiwg+aVtOaPkOWPlumAu+i+kQogICAgaWYgKHR5cGVvZiBsb2dpbkRhdGEgPT09ICdzdHJpbmcnKSB7CiAgICAgIC8vIOWmguaenGxvZ2luRGF0YeaYr+Wtl+espuS4su+8jOWPr+iDveebtOaOpeWMheWQq+S6hmNvb2tpZeS/oeaBrwogICAgICByZXR1cm4gbG9naW5EYXRhOwogICAgfSBlbHNlIGlmICh0eXBlb2YgbG9naW5EYXRhID09PSAnb2JqZWN0JykgewogICAgICAvLyDlpoLmnpxsb2dpbkRhdGHmmK/lr7nosaHvvIzmn6Xmib5jb29raWXlrZfmrrUKICAgICAgaWYgKGxvZ2luRGF0YS5jb29raWUpIHsKICAgICAgICByZXR1cm4gbG9naW5EYXRhLmNvb2tpZTsKICAgICAgfSBlbHNlIGlmIChsb2dpbkRhdGEuY29va2llcykgewogICAgICAgIHJldHVybiBsb2dpbkRhdGEuY29va2llczsKICAgICAgfSBlbHNlIGlmIChsb2dpbkRhdGEuZGF0YSAmJiB0eXBlb2YgbG9naW5EYXRhLmRhdGEgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy8g5aaC5p6cZGF0YeWtl+auteaYr+Wtl+espuS4su+8jOWPr+iDveWMheWQq+S6hmNvb2tpZeS/oeaBrwogICAgICAgIHJldHVybiBsb2dpbkRhdGEuZGF0YTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ+aPkOWPlkNvb2tpZeS/oeaBr+Wksei0pTonLCBlcnJvcik7CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KCi8vIOWTjeW6lOaLpuaIquWZqApiaWxpYmlsaUFwaS5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKHJlc3BvbnNlID0+IHsKICBjb25zdCByZXMgPSByZXNwb25zZS5kYXRhOwogIC8vIOS/ruaUuei/memHjOS7peaUr+aMgeWQjuerr+i/lOWbnueahGNvZGXmoLzlvI8gKDDooajnpLrmiJDlip8pCiAgaWYgKHJlcy5jb2RlICE9PSAwKSB7CiAgICBjb25zb2xlLmxvZygn6K+35rGC5aSx6LSlOicsIHJlcy5tZXNzYWdlKTsKICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IocmVzLm1lc3NhZ2UgfHwgJ0Vycm9yJykpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gcmVzOwogIH0KfSwgZXJyb3IgPT4gewogIGlmIChlcnJvci5yZXNwb25zZSkgewogICAgc3dpdGNoIChlcnJvci5yZXNwb25zZS5zdGF0dXMpIHsKICAgICAgY2FzZSA0MDE6CiAgICAgICAgLy8g5pyq5o6I5p2D77yM5riF6Zmk55m75b2V5L+h5oGvCiAgICAgICAgQmlsaWJpbGlBdXRoLmNsZWFyTG9naW5JbmZvKCk7CiAgICAgICAgLy8g5Y+v5Lul6Lez6L2s5Yiw55m75b2V6aG16Z2i5oiW5o+Q56S66YeN5paw55m75b2VCiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgNDAzOgogICAgICAgIC8vIOemgeatouiuv+mXrgogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iuv+mXruiiq+emgeatoicpOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ivt+axgumUmeivrzonLCBlcnJvci5yZXNwb25zZS5zdGF0dXMpOwogICAgfQogIH0KICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwp9KTsKZXhwb3J0IGRlZmF1bHQgYmlsaWJpbGlBcGk7"},{"version":3,"names":["axios","BilibiliAuth","bilibiliApi","create","baseURL","timeout","interceptors","request","use","config","needAuth","loginInfo","getLoginInfo","data","cookies","extractCookiesFromLoginInfo","headers","error","Promise","reject","loginData","cookie","console","response","res","code","log","message","Error","status","clearLoginInfo"],"sources":["/Users/tbw/work/btProject/reaction-cut/frontend/src/utils/bilibiliInterceptor.js"],"sourcesContent":["// Bilibili API拦截器\nimport axios from 'axios'\nimport BilibiliAuth from './bilibiliAuth'\n\n// 创建axios实例\nconst bilibiliApi = axios.create({\n  baseURL: '/api', // 使用代理避免跨域问题\n  timeout: 10000\n})\n\n// 请求拦截器\nbilibiliApi.interceptors.request.use(\n  config => {\n    // 检查是否需要认证\n    if (config.needAuth) {\n      const loginInfo = BilibiliAuth.getLoginInfo()\n      if (loginInfo && loginInfo.data) {\n        // 从登录信息中提取cookie并添加到请求头\n        const cookies = extractCookiesFromLoginInfo(loginInfo.data)\n        if (cookies) {\n          config.headers['Cookie'] = cookies\n        }\n      }\n    }\n    return config\n  },\n  error => {\n    return Promise.reject(error)\n  }\n)\n\n// 从登录信息中提取Cookie\nfunction extractCookiesFromLoginInfo(loginData) {\n  try {\n    // 根据实际的登录响应结构调整提取逻辑\n    if (typeof loginData === 'string') {\n      // 如果loginData是字符串，可能直接包含了cookie信息\n      return loginData\n    } else if (typeof loginData === 'object') {\n      // 如果loginData是对象，查找cookie字段\n      if (loginData.cookie) {\n        return loginData.cookie\n      } else if (loginData.cookies) {\n        return loginData.cookies\n      } else if (loginData.data && typeof loginData.data === 'string') {\n        // 如果data字段是字符串，可能包含了cookie信息\n        return loginData.data\n      }\n    }\n    return null\n  } catch (error) {\n    console.error('提取Cookie信息失败:', error)\n    return null\n  }\n}\n\n// 响应拦截器\nbilibiliApi.interceptors.response.use(\n  response => {\n    const res = response.data\n    // 修改这里以支持后端返回的code格式 (0表示成功)\n    if (res.code !== 0) {\n      console.log('请求失败:', res.message)\n      return Promise.reject(new Error(res.message || 'Error'))\n    } else {\n      return res\n    }\n  },\n  error => {\n    if (error.response) {\n      switch (error.response.status) {\n        case 401:\n          // 未授权，清除登录信息\n          BilibiliAuth.clearLoginInfo()\n          // 可以跳转到登录页面或提示重新登录\n          break\n        case 403:\n          // 禁止访问\n          console.error('访问被禁止')\n          break\n        default:\n          console.error('请求错误:', error.response.status)\n      }\n    }\n    return Promise.reject(error)\n  }\n)\n\nexport default bilibiliApi"],"mappings":"AAAA;AACA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,YAAY,MAAM,gBAAgB;;AAEzC;AACA,MAAMC,WAAW,GAAGF,KAAK,CAACG,MAAM,CAAC;EAC/BC,OAAO,EAAE,MAAM;EAAE;EACjBC,OAAO,EAAE;AACX,CAAC,CAAC;;AAEF;AACAH,WAAW,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CAClCC,MAAM,IAAI;EACR;EACA,IAAIA,MAAM,CAACC,QAAQ,EAAE;IACnB,MAAMC,SAAS,GAAGV,YAAY,CAACW,YAAY,CAAC,CAAC;IAC7C,IAAID,SAAS,IAAIA,SAAS,CAACE,IAAI,EAAE;MAC/B;MACA,MAAMC,OAAO,GAAGC,2BAA2B,CAACJ,SAAS,CAACE,IAAI,CAAC;MAC3D,IAAIC,OAAO,EAAE;QACXL,MAAM,CAACO,OAAO,CAAC,QAAQ,CAAC,GAAGF,OAAO;MACpC;IACF;EACF;EACA,OAAOL,MAAM;AACf,CAAC,EACDQ,KAAK,IAAI;EACP,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAC9B,CACF,CAAC;;AAED;AACA,SAASF,2BAA2BA,CAACK,SAAS,EAAE;EAC9C,IAAI;IACF;IACA,IAAI,OAAOA,SAAS,KAAK,QAAQ,EAAE;MACjC;MACA,OAAOA,SAAS;IAClB,CAAC,MAAM,IAAI,OAAOA,SAAS,KAAK,QAAQ,EAAE;MACxC;MACA,IAAIA,SAAS,CAACC,MAAM,EAAE;QACpB,OAAOD,SAAS,CAACC,MAAM;MACzB,CAAC,MAAM,IAAID,SAAS,CAACN,OAAO,EAAE;QAC5B,OAAOM,SAAS,CAACN,OAAO;MAC1B,CAAC,MAAM,IAAIM,SAAS,CAACP,IAAI,IAAI,OAAOO,SAAS,CAACP,IAAI,KAAK,QAAQ,EAAE;QAC/D;QACA,OAAOO,SAAS,CAACP,IAAI;MACvB;IACF;IACA,OAAO,IAAI;EACb,CAAC,CAAC,OAAOI,KAAK,EAAE;IACdK,OAAO,CAACL,KAAK,CAAC,eAAe,EAAEA,KAAK,CAAC;IACrC,OAAO,IAAI;EACb;AACF;;AAEA;AACAf,WAAW,CAACI,YAAY,CAACiB,QAAQ,CAACf,GAAG,CACnCe,QAAQ,IAAI;EACV,MAAMC,GAAG,GAAGD,QAAQ,CAACV,IAAI;EACzB;EACA,IAAIW,GAAG,CAACC,IAAI,KAAK,CAAC,EAAE;IAClBH,OAAO,CAACI,GAAG,CAAC,OAAO,EAAEF,GAAG,CAACG,OAAO,CAAC;IACjC,OAAOT,OAAO,CAACC,MAAM,CAAC,IAAIS,KAAK,CAACJ,GAAG,CAACG,OAAO,IAAI,OAAO,CAAC,CAAC;EAC1D,CAAC,MAAM;IACL,OAAOH,GAAG;EACZ;AACF,CAAC,EACDP,KAAK,IAAI;EACP,IAAIA,KAAK,CAACM,QAAQ,EAAE;IAClB,QAAQN,KAAK,CAACM,QAAQ,CAACM,MAAM;MAC3B,KAAK,GAAG;QACN;QACA5B,YAAY,CAAC6B,cAAc,CAAC,CAAC;QAC7B;QACA;MACF,KAAK,GAAG;QACN;QACAR,OAAO,CAACL,KAAK,CAAC,OAAO,CAAC;QACtB;MACF;QACEK,OAAO,CAACL,KAAK,CAAC,OAAO,EAAEA,KAAK,CAACM,QAAQ,CAACM,MAAM,CAAC;IACjD;EACF;EACA,OAAOX,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAC9B,CACF,CAAC;AAED,eAAef,WAAW","ignoreList":[]}]}