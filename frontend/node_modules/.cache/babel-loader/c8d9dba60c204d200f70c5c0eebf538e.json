{"remainingRequest":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/babel-loader@8.4.1_@babel+core@7.28.5_webpack@4.47.0/node_modules/babel-loader/lib/index.js!/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tbw/work/btProject/reaction-cut/frontend/src/components/ImprovedQRCodeLogin.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/src/components/ImprovedQRCodeLogin.vue","mtime":1761575496809},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/babel-loader@8.4.1_@babel+core@7.28.5_webpack@4.47.0/node_modules/babel-loader/lib/index.js","mtime":1761026722096},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js","mtime":1761026704427}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgZ2VuZXJhdGVRUkNvZGUsIHBvbGxRUkNvZGVTdGF0dXMsIHBlcmZvcm1RUkNvZGVMb2dpbiB9IGZyb20gJ0AvYXBpL2JpbGliaWxpQXV0aCc7CmltcG9ydCBxcmNvZGUgZnJvbSAncXJjb2RlLWdlbmVyYXRvcic7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnSW1wcm92ZWRRUkNvZGVMb2dpbicsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICBxckNvZGVVcmw6ICcnLAogICAgICBxcmNvZGVLZXk6ICcnLAogICAgICBxckNvZGVTdGF0dXM6ICcnLAogICAgICAvLyAncGVuZGluZycsICdzY2FubmVkJywgJ2NvbmZpcm1lZCcsICdleHBpcmVkJywgJ3N1Y2Nlc3MnCiAgICAgIGxvZ2luU3VjY2VzczogZmFsc2UsCiAgICAgIHBvbGxJbnRlcnZhbDogbnVsbCwKICAgICAgcmV0cnlDb3VudDogMCwKICAgICAgbWF4UmV0cmllczogMwogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBzdGF0dXNNZXNzYWdlKCkgewogICAgICBzd2l0Y2ggKHRoaXMucXJDb2RlU3RhdHVzKSB7CiAgICAgICAgY2FzZSAncGVuZGluZyc6CiAgICAgICAgICByZXR1cm4gJ+etieW+heaJq+aPjy4uLic7CiAgICAgICAgY2FzZSAnc2Nhbm5lZCc6CiAgICAgICAgICByZXR1cm4gJ+W3suaJq+aPj++8jOivt+WcqOaJi+acuuS4iuehruiupCc7CiAgICAgICAgY2FzZSAnY29uZmlybWVkJzoKICAgICAgICAgIHJldHVybiAn55m75b2V5oiQ5YqfJzsKICAgICAgICBjYXNlICdleHBpcmVkJzoKICAgICAgICAgIHJldHVybiAn5LqM57u056CB5bey6L+H5pyfJzsKICAgICAgICBjYXNlICdzdWNjZXNzJzoKICAgICAgICAgIHJldHVybiAn55m75b2V5oiQ5YqfJzsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuICfor7fmiavmj4/kuoznu7TnoIEnOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBnZW5lcmF0ZVFSQ29kZSgpIHsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5yZXRyeUNvdW50ID0gMDsKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCB0aGlzLl9nZW5lcmF0ZVFSQ29kZVdpdGhSZXRyeSgpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+eUn+aIkOS6jOe7tOeggeWksei0pTonLCBlcnJvcik7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign55Sf5oiQ5LqM57u056CB5aSx6LSlOiAnICsgZXJyb3IubWVzc2FnZSk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBfZ2VuZXJhdGVRUkNvZGVXaXRoUmV0cnkoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZW5lcmF0ZVFSQ29kZSgpOwogICAgICAgIGNvbnNvbGUubG9nKCfkuoznu7TnoIHnlJ/miJDlk43lupQ6JywgcmVzcG9uc2UpOwogICAgICAgIGlmIChyZXNwb25zZS5jb2RlID09PSAwKSB7CiAgICAgICAgICAvLyDpqozor4Hov5Tlm57nmoTmlbDmja4KICAgICAgICAgIGlmICghcmVzcG9uc2UuZGF0YSB8fCAhcmVzcG9uc2UuZGF0YS51cmwgfHwgIXJlc3BvbnNlLmRhdGEucXJjb2RlX2tleSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+i/lOWbnueahOS6jOe7tOeggeaVsOaNruagvOW8j+S4jeato+ehricpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5xckNvZGVVcmwgPSByZXNwb25zZS5kYXRhLnVybDsKICAgICAgICAgIHRoaXMucXJjb2RlS2V5ID0gcmVzcG9uc2UuZGF0YS5xcmNvZGVfa2V5OwogICAgICAgICAgdGhpcy5xckNvZGVTdGF0dXMgPSAncGVuZGluZyc7CiAgICAgICAgICBjb25zb2xlLmxvZygn5LqM57u056CBVVJMOicsIHRoaXMucXJDb2RlVXJsKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfkuoznu7TnoIFLZXk6JywgdGhpcy5xcmNvZGVLZXkpOwoKICAgICAgICAgIC8vIOehruS/nURPTeabtOaWsOWQjuWGjeeUn+aIkOS6jOe7tOeggQogICAgICAgICAgYXdhaXQgdGhpcy4kbmV4dFRpY2soKTsKCiAgICAgICAgICAvLyDkvb/nlKhRUkNvZGXlupPnlJ/miJDkuoznu7TnoIEKICAgICAgICAgIGF3YWl0IHRoaXMuZ2VuZXJhdGVRUkNvZGVJbWFnZSgpOwoKICAgICAgICAgIC8vIOW8gOWni+i9ruivogogICAgICAgICAgdGhpcy5zdGFydFBvbGxpbmcoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3BvbnNlLm1lc3NhZ2UgfHwgJ+eUn+aIkOS6jOe7tOeggeWksei0pScpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB0aGlzLnJldHJ5Q291bnQrKzsKICAgICAgICBpZiAodGhpcy5yZXRyeUNvdW50IDw9IHRoaXMubWF4UmV0cmllcykgewogICAgICAgICAgY29uc29sZS5sb2coYOeUn+aIkOS6jOe7tOeggeWksei0pe+8jOato+WcqOmHjeivlSAoJHt0aGlzLnJldHJ5Q291bnR9LyR7dGhpcy5tYXhSZXRyaWVzfSkuLi5gKTsKICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7CiAgICAgICAgICByZXR1cm4gdGhpcy5fZ2VuZXJhdGVRUkNvZGVXaXRoUmV0cnkoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZ2VuZXJhdGVRUkNvZGVJbWFnZSgpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBpZiAoIXRoaXMucXJDb2RlVXJsIHx8ICF0aGlzLiRyZWZzLnFyQ29kZUNhbnZhcykgewogICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ+e8uuWwkeeUn+aIkOS6jOe7tOeggeeahOW/heimgeWPguaVsCcpOwogICAgICAgICAgY29uc29sZS53YXJuKCfnvLrlsJHnlJ/miJDkuoznu7TnoIHnmoTlv4XopoHlj4LmlbA6JywgewogICAgICAgICAgICBxckNvZGVVcmw6IHRoaXMucXJDb2RlVXJsLAogICAgICAgICAgICBjYW52YXM6IHRoaXMuJHJlZnMucXJDb2RlQ2FudmFzCiAgICAgICAgICB9KTsKICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5byA5aeL5L2/55SocXJjb2RlLWdlbmVyYXRvcueUn+aIkOS6jOe7tOeggTonLCB7CiAgICAgICAgICAgIHVybDogdGhpcy5xckNvZGVVcmwKICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIOa4heepuuWuueWZqAogICAgICAgICAgdGhpcy4kcmVmcy5xckNvZGVDYW52YXMuaW5uZXJIVE1MID0gJyc7CgogICAgICAgICAgLy8g5L2/55SocXJjb2RlLWdlbmVyYXRvcueUn+aIkOS6jOe7tOeggQogICAgICAgICAgY29uc3QgcXIgPSBxcmNvZGUoMCwgJ00nKTsKICAgICAgICAgIHFyLmFkZERhdGEodGhpcy5xckNvZGVVcmwpOwogICAgICAgICAgcXIubWFrZSgpOwoKICAgICAgICAgIC8vIOWIm+W7umNhbnZhc+WFg+e0oAogICAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICBjYW52YXMud2lkdGggPSAzMDA7CiAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gMzAwOwogICAgICAgICAgY2FudmFzLnN0eWxlLm1heFdpZHRoID0gJzEwMCUnOwogICAgICAgICAgY2FudmFzLnN0eWxlLm1heEhlaWdodCA9ICcxMDAlJzsKCiAgICAgICAgICAvLyDojrflj5ZjYW52YXPkuIrkuIvmloflubbnu5jliLbkuoznu7TnoIEKICAgICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgY29uc3QgY2VsbFNpemUgPSBNYXRoLmZsb29yKGNhbnZhcy53aWR0aCAvIHFyLmdldE1vZHVsZUNvdW50KCkpOwoKICAgICAgICAgIC8vIOe7mOWItuiDjOaZrwogICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjZmZmZmZmJzsKICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwoKICAgICAgICAgIC8vIOe7mOWItuS6jOe7tOeggeaooeWdlwogICAgICAgICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgcXIuZ2V0TW9kdWxlQ291bnQoKTsgcm93KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgcXIuZ2V0TW9kdWxlQ291bnQoKTsgY29sKyspIHsKICAgICAgICAgICAgICBpZiAocXIuaXNEYXJrKHJvdywgY29sKSkgewogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDAwMDAwJzsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdChjb2wgKiBjZWxsU2l6ZSwgcm93ICogY2VsbFNpemUsIGNlbGxTaXplLCBjZWxsU2l6ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8g5bCGY2FudmFz5re75Yqg5Yiw5a655Zmo5LitCiAgICAgICAgICB0aGlzLiRyZWZzLnFyQ29kZUNhbnZhcy5hcHBlbmRDaGlsZChjYW52YXMpOwogICAgICAgICAgY29uc29sZS5sb2coJ+S6jOe7tOeggeeUn+aIkOaIkOWKnycpOwogICAgICAgICAgLy8g6aqM6K+B5LqM57u056CB5piv5ZCm5q2j56Gu55Sf5oiQCiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIm+W7uuS6jOe7tOeggeWbvueJh+Wksei0pTonLCBlcnJvcik7CiAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc3RhcnRQb2xsaW5nKCkgewogICAgICAvLyDlgZzmraLkuYvliY3nmoTova7or6IKICAgICAgdGhpcy5zdG9wUG9sbGluZygpOwoKICAgICAgLy8g5byA5aeL5paw55qE6L2u6K+iCiAgICAgIHRoaXMucG9sbEludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgIHRoaXMucG9sbFFSQ29kZVN0YXR1cygpOwogICAgICB9LCAzMDAwKTsgLy8g5q+PM+enkui9ruivouS4gOasoQogICAgfSwKICAgIGFzeW5jIHBvbGxRUkNvZGVTdGF0dXMoKSB7CiAgICAgIGlmICghdGhpcy5xcmNvZGVLZXkpIHJldHVybjsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHBvbGxRUkNvZGVTdGF0dXModGhpcy5xcmNvZGVLZXkpOwogICAgICAgIGlmIChyZXNwb25zZS5jb2RlID09PSAwKSB7CiAgICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIGNvbnN0IGNvZGUgPSBkYXRhLmNvZGU7CiAgICAgICAgICBzd2l0Y2ggKGNvZGUpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIC8vIOeZu+W9leaIkOWKnwogICAgICAgICAgICAgIHRoaXMucXJDb2RlU3RhdHVzID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgIHRoaXMubG9naW5TdWNjZXNzID0gdHJ1ZTsKICAgICAgICAgICAgICB0aGlzLnN0b3BQb2xsaW5nKCk7CiAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnbG9naW4tc3VjY2VzcycpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgLy8g5pyq5omr56CBCiAgICAgICAgICAgICAgdGhpcy5xckNvZGVTdGF0dXMgPSAncGVuZGluZyc7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAvLyDlt7Lmiavmj4/mnKrnoa7orqQKICAgICAgICAgICAgICB0aGlzLnFyQ29kZVN0YXR1cyA9ICdzY2FubmVkJzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIC8vIOS6jOe7tOeggeWkseaViAogICAgICAgICAgICAgIHRoaXMucXJDb2RlU3RhdHVzID0gJ2V4cGlyZWQnOwogICAgICAgICAgICAgIHRoaXMuc3RvcFBvbGxpbmcoKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aGlzLnFyQ29kZVN0YXR1cyA9ICdwZW5kaW5nJzsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCfova7or6Lkuoznu7TnoIHnirbmgIHlpLHotKU6JywgcmVzcG9uc2UubWVzc2FnZSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+i9ruivouS6jOe7tOeggeeKtuaAgeWksei0pTonLCBlcnJvcik7CiAgICAgIH0KICAgIH0sCiAgICBzdG9wUG9sbGluZygpIHsKICAgICAgaWYgKHRoaXMucG9sbEludGVydmFsKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnBvbGxJbnRlcnZhbCk7CiAgICAgICAgdGhpcy5wb2xsSW50ZXJ2YWwgPSBudWxsOwogICAgICB9CiAgICB9LAogICAgcmVmcmVzaFFSQ29kZSgpIHsKICAgICAgdGhpcy5zdG9wUG9sbGluZygpOwogICAgICB0aGlzLnFyQ29kZVVybCA9ICcnOwogICAgICB0aGlzLnFyY29kZUtleSA9ICcnOwogICAgICB0aGlzLnFyQ29kZVN0YXR1cyA9ICcnOwogICAgICB0aGlzLmxvZ2luU3VjY2VzcyA9IGZhbHNlOwogICAgICB0aGlzLmdlbmVyYXRlUVJDb2RlKCk7CiAgICB9LAogICAgYXN5bmMgcGVyZm9ybUF1dG9Mb2dpbigpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHBlcmZvcm1RUkNvZGVMb2dpbigpOwogICAgICAgIGlmIChyZXNwb25zZS5jb2RlID09PSAwKSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MocmVzcG9uc2UubWVzc2FnZSB8fCAn55m75b2V5rWB56iL5bey5ZCv5YqoJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzcG9uc2UubWVzc2FnZSB8fCAn5ZCv5Yqo55m75b2V5rWB56iL5aSx6LSlJyk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WQr+WKqOeZu+W9lea1geeoi+Wksei0pTogJyArIGVycm9yLm1lc3NhZ2UpOwogICAgICB9CiAgICB9CiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgLy8g57uE5Lu26ZSA5q+B5YmN5YGc5q2i6L2u6K+iCiAgICB0aGlzLnN0b3BQb2xsaW5nKCk7CiAgfQp9Ow=="},{"version":3,"names":["generateQRCode","pollQRCodeStatus","performQRCodeLogin","qrcode","name","data","loading","qrCodeUrl","qrcodeKey","qrCodeStatus","loginSuccess","pollInterval","retryCount","maxRetries","computed","statusMessage","methods","_generateQRCodeWithRetry","error","console","$message","message","response","log","code","url","qrcode_key","Error","$nextTick","generateQRCodeImage","startPolling","Promise","resolve","setTimeout","reject","$refs","qrCodeCanvas","warn","canvas","innerHTML","qr","addData","make","document","createElement","width","height","style","maxWidth","maxHeight","ctx","getContext","cellSize","Math","floor","getModuleCount","fillStyle","fillRect","row","col","isDark","appendChild","stopPolling","setInterval","$emit","clearInterval","refreshQRCode","performAutoLogin","success","beforeDestroy"],"sources":["src/components/ImprovedQRCodeLogin.vue"],"sourcesContent":["<template>\n  <div class=\"improved-qrcode-login\">\n    <h2>Bilibili 二维码登录</h2>\n    \n    <div v-if=\"!qrCodeUrl\" class=\"generate-section\">\n      <el-button type=\"primary\" @click=\"generateQRCode\" :loading=\"loading\">\n        {{ loading ? '生成中...' : '生成二维码' }}\n      </el-button>\n    </div>\n    \n    <div v-else class=\"qrcode-section\">\n      <!-- 使用canvas显示二维码 -->\n      <div ref=\"qrCodeCanvas\" class=\"qrcode-canvas-wrapper\"></div>\n      \n      <div class=\"qrcode-info\">\n        <p>请使用 Bilibili 手机客户端扫描二维码</p>\n        <p class=\"status-text\">{{ statusMessage }}</p>\n      </div>\n      \n      <div class=\"qrcode-actions\">\n        <el-button @click=\"refreshQRCode\">刷新二维码</el-button>\n        <el-button type=\"primary\" @click=\"performAutoLogin\">自动登录</el-button>\n      </div>\n    </div>\n    \n    <div v-if=\"loginSuccess\" class=\"success-section\">\n      <el-alert\n        title=\"登录成功！\"\n        type=\"success\"\n        description=\"您已成功登录 Bilibili 账户\"\n        show-icon\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { generateQRCode, pollQRCodeStatus, performQRCodeLogin } from '@/api/bilibiliAuth'\nimport qrcode from 'qrcode-generator'\n\nexport default {\n  name: 'ImprovedQRCodeLogin',\n  data() {\n    return {\n      loading: false,\n      qrCodeUrl: '',\n      qrcodeKey: '',\n      qrCodeStatus: '', // 'pending', 'scanned', 'confirmed', 'expired', 'success'\n      loginSuccess: false,\n      pollInterval: null,\n      retryCount: 0,\n      maxRetries: 3\n    }\n  },\n  computed: {\n    statusMessage() {\n      switch (this.qrCodeStatus) {\n        case 'pending':\n          return '等待扫描...'\n        case 'scanned':\n          return '已扫描，请在手机上确认'\n        case 'confirmed':\n          return '登录成功'\n        case 'expired':\n          return '二维码已过期'\n        case 'success':\n          return '登录成功'\n        default:\n          return '请扫描二维码'\n      }\n    }\n  },\n  methods: {\n    async generateQRCode() {\n      this.loading = true\n      this.retryCount = 0\n      \n      try {\n        await this._generateQRCodeWithRetry()\n      } catch (error) {\n        console.error('生成二维码失败:', error)\n        this.$message.error('生成二维码失败: ' + error.message)\n      } finally {\n        this.loading = false\n      }\n    },\n    \n    async _generateQRCodeWithRetry() {\n      try {\n        const response = await generateQRCode()\n        console.log('二维码生成响应:', response)\n        \n        if (response.code === 0) {\n          // 验证返回的数据\n          if (!response.data || !response.data.url || !response.data.qrcode_key) {\n            throw new Error('返回的二维码数据格式不正确')\n          }\n          \n          this.qrCodeUrl = response.data.url\n          this.qrcodeKey = response.data.qrcode_key\n          this.qrCodeStatus = 'pending'\n          \n          console.log('二维码URL:', this.qrCodeUrl)\n          console.log('二维码Key:', this.qrcodeKey)\n          \n          // 确保DOM更新后再生成二维码\n          await this.$nextTick()\n          \n          // 使用QRCode库生成二维码\n          await this.generateQRCodeImage()\n          \n          // 开始轮询\n          this.startPolling()\n        } else {\n          throw new Error(response.message || '生成二维码失败')\n        }\n      } catch (error) {\n        this.retryCount++\n        if (this.retryCount <= this.maxRetries) {\n          console.log(`生成二维码失败，正在重试 (${this.retryCount}/${this.maxRetries})...`)\n          await new Promise(resolve => setTimeout(resolve, 1000))\n          return this._generateQRCodeWithRetry()\n        } else {\n          throw error\n        }\n      }\n    },\n    \n    generateQRCodeImage() {\n      return new Promise((resolve, reject) => {\n        if (!this.qrCodeUrl || !this.$refs.qrCodeCanvas) {\n          const error = new Error('缺少生成二维码的必要参数')\n          console.warn('缺少生成二维码的必要参数:', { qrCodeUrl: this.qrCodeUrl, canvas: this.$refs.qrCodeCanvas })\n          reject(error)\n          return\n        }\n        \n        try {\n          console.log('开始使用qrcode-generator生成二维码:', { url: this.qrCodeUrl })\n          \n          // 清空容器\n          this.$refs.qrCodeCanvas.innerHTML = ''\n          \n          // 使用qrcode-generator生成二维码\n          const qr = qrcode(0, 'M')\n          qr.addData(this.qrCodeUrl)\n          qr.make()\n          \n          // 创建canvas元素\n          const canvas = document.createElement('canvas')\n          canvas.width = 300\n          canvas.height = 300\n          canvas.style.maxWidth = '100%'\n          canvas.style.maxHeight = '100%'\n          \n          // 获取canvas上下文并绘制二维码\n          const ctx = canvas.getContext('2d')\n          const cellSize = Math.floor(canvas.width / qr.getModuleCount())\n          \n          // 绘制背景\n          ctx.fillStyle = '#ffffff'\n          ctx.fillRect(0, 0, canvas.width, canvas.height)\n          \n          // 绘制二维码模块\n          for (let row = 0; row < qr.getModuleCount(); row++) {\n            for (let col = 0; col < qr.getModuleCount(); col++) {\n              if (qr.isDark(row, col)) {\n                ctx.fillStyle = '#000000'\n                ctx.fillRect(col * cellSize, row * cellSize, cellSize, cellSize)\n              }\n            }\n          }\n          \n          // 将canvas添加到容器中\n          this.$refs.qrCodeCanvas.appendChild(canvas)\n          \n          console.log('二维码生成成功')\n          // 验证二维码是否正确生成\n          resolve()\n        } catch (error) {\n          console.error('创建二维码图片失败:', error)\n          reject(error)\n        }\n      })\n    },\n    \n    startPolling() {\n      // 停止之前的轮询\n      this.stopPolling()\n      \n      // 开始新的轮询\n      this.pollInterval = setInterval(() => {\n        this.pollQRCodeStatus()\n      }, 3000) // 每3秒轮询一次\n    },\n    \n    async pollQRCodeStatus() {\n      if (!this.qrcodeKey) return\n      \n      try {\n        const response = await pollQRCodeStatus(this.qrcodeKey)\n        \n        if (response.code === 0) {\n          const data = response.data\n          const code = data.code\n          \n          switch (code) {\n            case 0: // 登录成功\n              this.qrCodeStatus = 'success'\n              this.loginSuccess = true\n              this.stopPolling()\n              this.$emit('login-success')\n              break\n            case 1: // 未扫码\n              this.qrCodeStatus = 'pending'\n              break\n            case 2: // 已扫描未确认\n              this.qrCodeStatus = 'scanned'\n              break\n            case 3: // 二维码失效\n              this.qrCodeStatus = 'expired'\n              this.stopPolling()\n              break\n            default:\n              this.qrCodeStatus = 'pending'\n          }\n        } else {\n          console.warn('轮询二维码状态失败:', response.message)\n        }\n      } catch (error) {\n        console.error('轮询二维码状态失败:', error)\n      }\n    },\n    \n    stopPolling() {\n      if (this.pollInterval) {\n        clearInterval(this.pollInterval)\n        this.pollInterval = null\n      }\n    },\n    \n    refreshQRCode() {\n      this.stopPolling()\n      this.qrCodeUrl = ''\n      this.qrcodeKey = ''\n      this.qrCodeStatus = ''\n      this.loginSuccess = false\n      this.generateQRCode()\n    },\n    \n    async performAutoLogin() {\n      try {\n        const response = await performQRCodeLogin()\n        \n        if (response.code === 0) {\n          this.$message.success(response.message || '登录流程已启动')\n        } else {\n          this.$message.error(response.message || '启动登录流程失败')\n        }\n      } catch (error) {\n        this.$message.error('启动登录流程失败: ' + error.message)\n      }\n    }\n  },\n  \n  beforeDestroy() {\n    // 组件销毁前停止轮询\n    this.stopPolling()\n  }\n}\n</script>\n\n<style scoped>\n.improved-qrcode-login {\n  max-width: 90vw;\n  margin: 0 auto;\n  padding: 20px;\n}\n\n.generate-section {\n  text-align: center;\n  padding: 40px 0;\n}\n\n.qrcode-section {\n  text-align: center;\n}\n\n.qrcode-canvas-wrapper {\n  display: flex;\n  justify-content: center;\n  margin: 20px 0;\n  min-height: 300px;\n  align-items: center;\n  border: 1px dashed #dcdfe6;\n  border-radius: 4px;\n}\n\n.qrcode-info {\n  margin: 20px 0;\n}\n\n.status-text {\n  font-weight: bold;\n  color: #409EFF;\n}\n\n.qrcode-actions {\n  margin: 20px 0;\n}\n\n.success-section {\n  margin-top: 20px;\n}\n</style>"],"mappings":"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","ignoreList":[]}]}