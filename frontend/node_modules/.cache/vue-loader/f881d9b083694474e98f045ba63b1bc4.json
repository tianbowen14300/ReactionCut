{"remainingRequest":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tbw/work/btProject/reaction-cut/frontend/src/views/VideoProcessor.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/src/views/VideoProcessor.vue","mtime":1762077994469},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/babel-loader@8.4.1_@babel+core@7.28.5_webpack@4.47.0/node_modules/babel-loader/lib/index.js","mtime":1761026722096},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js","mtime":1761026704427}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IGNyZWF0ZVByb2Nlc3NUYXNrLCBnZXRQcm9jZXNzU3RhdHVzIH0gZnJvbSAnQC9hcGkvdmlkZW8nCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ1ZpZGVvUHJvY2Vzc29yJywKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcHJvY2Vzc0Zvcm06IHsKICAgICAgICB0YXNrTmFtZTogJycKICAgICAgfSwKICAgICAgZmlsZUxpc3Q6IFtdLAogICAgICBjbGlwczogW10sCiAgICAgIHByb2Nlc3Npbmc6IGZhbHNlLAogICAgICB0YXNrSWQ6IG51bGwsCiAgICAgIHRhc2tJbmZvOiB7fQogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIHRhc2tJZDogewogICAgICBoYW5kbGVyKG5ld1ZhbCkgewogICAgICAgIGlmIChuZXdWYWwpIHsKICAgICAgICAgIHRoaXMuc3RhcnRQb2xsaW5nKCkKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIOWkhOeQhuaWh+S7tuWPmOWMlgogICAgaGFuZGxlRmlsZUNoYW5nZShmaWxlLCBmaWxlTGlzdCkgewogICAgICB0aGlzLmZpbGVMaXN0ID0gZmlsZUxpc3QKICAgICAgLy8g5re75Yqg5Yiw54mH5q615YiX6KGoCiAgICAgIGNvbnN0IGNsaXAgPSB7CiAgICAgICAgZmlsZU5hbWU6IGZpbGUubmFtZSwKICAgICAgICBzZXF1ZW5jZTogdGhpcy5jbGlwcy5sZW5ndGggKyAxLAogICAgICAgIHN0YXJ0VGltZTogJzAwOjAwOjAwJywKICAgICAgICBlbmRUaW1lOiAnMDA6MDA6MDAnCiAgICAgIH0KICAgICAgdGhpcy5jbGlwcy5wdXNoKGNsaXApCiAgICB9LAogICAgCiAgICAvLyDliKDpmaTniYfmrrUKICAgIHJlbW92ZUNsaXAoaW5kZXgpIHsKICAgICAgdGhpcy5jbGlwcy5zcGxpY2UoaW5kZXgsIDEpCiAgICAgIC8vIOmHjeaWsOaOkuW6j+W6j+WPtwogICAgICB0aGlzLmNsaXBzLmZvckVhY2goKGNsaXAsIGkpID0+IHsKICAgICAgICBjbGlwLnNlcXVlbmNlID0gaSArIDEKICAgICAgfSkKICAgIH0sCiAgICAKICAgIC8vIOaPkOS6pOWkhOeQhuS7u+WKoQogICAgYXN5bmMgc3VibWl0UHJvY2Vzc1Rhc2soKSB7CiAgICAgIGlmICghdGhpcy5wcm9jZXNzRm9ybS50YXNrTmFtZSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn6K+36L6T5YWl5Lu75Yqh5ZCN56ewJykKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICAKICAgICAgaWYgKHRoaXMuY2xpcHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfor7foh7PlsJHpgInmi6nkuIDkuKrop4bpopHmlofku7YnKQogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIAogICAgICB0aGlzLnByb2Nlc3NpbmcgPSB0cnVlCiAgICAgIHRyeSB7CiAgICAgICAgLy8g6L2s5o2i5pe26Ze05qC85byPCiAgICAgICAgY29uc3QgY2xpcHMgPSB0aGlzLmNsaXBzLm1hcChjbGlwID0+ICh7CiAgICAgICAgICAuLi5jbGlwLAogICAgICAgICAgc3RhcnRUaW1lOiBjbGlwLnN0YXJ0VGltZSB8fCAnMDA6MDA6MDAnLAogICAgICAgICAgZW5kVGltZTogY2xpcC5lbmRUaW1lIHx8ICcwMDowMDowMCcKICAgICAgICB9KSkKICAgICAgICAKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNyZWF0ZVByb2Nlc3NUYXNrKHsKICAgICAgICAgIHRhc2tOYW1lOiB0aGlzLnByb2Nlc3NGb3JtLnRhc2tOYW1lLAogICAgICAgICAgY2xpcHM6IGNsaXBzCiAgICAgICAgfSkKICAgICAgICAKICAgICAgICBpZiAocmVzcG9uc2UuY29kZSA9PT0gMCkgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCflpITnkIbku7vliqHliJvlu7rmiJDlip8nKQogICAgICAgICAgdGhpcy50YXNrSWQgPSByZXNwb25zZS5kYXRhCiAgICAgICAgICB0aGlzLnRhc2tJbmZvID0ge30KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXNwb25zZS5tZXNzYWdlKQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfliJvlu7rlpITnkIbku7vliqHlpLHotKU6ICcgKyBlcnJvci5tZXNzYWdlKQogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMucHJvY2Vzc2luZyA9IGZhbHNlCiAgICAgIH0KICAgIH0sCiAgICAKICAgIC8vIOW8gOWni+i9ruivouS7u+WKoeeKtuaAgQogICAgc3RhcnRQb2xsaW5nKCkgewogICAgICB0aGlzLnBvbGxpbmdUaW1lciA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXRQcm9jZXNzU3RhdHVzKHRoaXMudGFza0lkKQogICAgICAgICAgaWYgKHJlc3BvbnNlLmNvZGUgPT09IDApIHsKICAgICAgICAgICAgdGhpcy50YXNrSW5mbyA9IHJlc3BvbnNlLmRhdGEKICAgICAgICAgICAgLy8g5aaC5p6c5Lu75Yqh5a6M5oiQ5oiW5aSx6LSl77yM5YGc5q2i6L2u6K+iCiAgICAgICAgICAgIGlmICh0aGlzLnRhc2tJbmZvLnN0YXR1cyA9PT0gMiB8fCB0aGlzLnRhc2tJbmZvLnN0YXR1cyA9PT0gMykgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wb2xsaW5nVGltZXIpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W5Lu75Yqh54q25oCB5aSx6LSlOicsIGVycm9yKQogICAgICAgIH0KICAgICAgfSwgMzAwMCkgLy8g5q+PM+enkuafpeivouS4gOasoQogICAgfSwKICAgIAogICAgLy8g6I635Y+W5aSE55CG54q25oCB5paH5pysCiAgICBnZXRQcm9jZXNzU3RhdHVzVGV4dChzdGF0dXMpIHsKICAgICAgY29uc3Qgc3RhdHVzTWFwID0gewogICAgICAgIDA6ICflvoXlpITnkIYnLAogICAgICAgIDE6ICflpITnkIbkuK0nLAogICAgICAgIDI6ICflpITnkIblrozmiJAnLAogICAgICAgIDM6ICflpITnkIblpLHotKUnCiAgICAgIH0KICAgICAgcmV0dXJuIHN0YXR1c01hcFtzdGF0dXNdIHx8ICfmnKrnn6UnCiAgICB9LAogICAgCiAgICAvLyDojrflj5blpITnkIbnirbmgIHnsbvlnosKICAgIGdldFByb2Nlc3NTdGF0dXNUeXBlKHN0YXR1cykgewogICAgICBjb25zdCB0eXBlTWFwID0gewogICAgICAgIDA6ICdpbmZvJywKICAgICAgICAxOiAnd2FybmluZycsCiAgICAgICAgMjogJ3N1Y2Nlc3MnLAogICAgICAgIDM6ICdkYW5nZXInCiAgICAgIH0KICAgICAgcmV0dXJuIHR5cGVNYXBbc3RhdHVzXSB8fCAnaW5mbycKICAgIH0sCiAgICAKICAgIC8vIOiOt+WPluaKleeov+eKtuaAgeaWh+acrAogICAgZ2V0VXBsb2FkU3RhdHVzVGV4dChzdGF0dXMpIHsKICAgICAgY29uc3Qgc3RhdHVzTWFwID0gewogICAgICAgIDA6ICfmnKrmipXnqL8nLAogICAgICAgIDE6ICfmipXnqL/kuK0nLAogICAgICAgIDI6ICfmipXnqL/miJDlip8nLAogICAgICAgIDM6ICfmipXnqL/lpLHotKUnCiAgICAgIH0KICAgICAgcmV0dXJuIHN0YXR1c01hcFtzdGF0dXNdIHx8ICfmnKrnn6UnCiAgICB9LAogICAgCiAgICAvLyDojrflj5bmipXnqL/nirbmgIHnsbvlnosKICAgIGdldFVwbG9hZFN0YXR1c1R5cGUoc3RhdHVzKSB7CiAgICAgIGNvbnN0IHR5cGVNYXAgPSB7CiAgICAgICAgMDogJ2luZm8nLAogICAgICAgIDE6ICd3YXJuaW5nJywKICAgICAgICAyOiAnc3VjY2VzcycsCiAgICAgICAgMzogJ2RhbmdlcicKICAgICAgfQogICAgICByZXR1cm4gdHlwZU1hcFtzdGF0dXNdIHx8ICdpbmZvJwogICAgfQogIH0sCiAgCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIC8vIOe7hOS7tumUgOavgeWJjea4hemZpOWumuaXtuWZqAogICAgaWYgKHRoaXMucG9sbGluZ1RpbWVyKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wb2xsaW5nVGltZXIpCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["VideoProcessor.vue"],"names":[],"mappings":";AAuGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"VideoProcessor.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"video-processor\">\n    <h2>视频处理与投稿</h2>\n    \n    <el-card class=\"input-card\">\n      <div slot=\"header\">\n        <span>处理任务配置</span>\n      </div>\n      <el-form :model=\"processForm\" ref=\"processForm\" label-width=\"100px\">\n        <el-form-item label=\"任务名称\">\n          <el-input \n            v-model=\"processForm.taskName\" \n            placeholder=\"请输入任务名称\"\n            style=\"width: 300px;\"\n          ></el-input>\n        </el-form-item>\n        \n        <el-form-item label=\"视频文件\">\n          <el-upload\n            action=\"#\"\n            :auto-upload=\"false\"\n            :file-list=\"fileList\"\n            :on-change=\"handleFileChange\"\n            multiple\n          >\n            <el-button slot=\"trigger\" size=\"small\" type=\"primary\">选择文件</el-button>\n            <div slot=\"tip\" class=\"el-upload__tip\">请选择要处理的视频文件</div>\n          </el-upload>\n        </el-form-item>\n      </el-form>\n    </el-card>\n    \n    <el-card class=\"clip-card\" v-if=\"clips.length > 0\">\n      <div slot=\"header\">\n        <span>视频片段设置</span>\n      </div>\n      <el-table :data=\"clips\" style=\"width: 100%\">\n        <el-table-column prop=\"fileName\" label=\"文件名\" width=\"200\"></el-table-column>\n        <el-table-column prop=\"sequence\" label=\"序号\" width=\"80\">\n          <template slot-scope=\"scope\">\n            <el-input-number v-model=\"scope.row.sequence\" :min=\"1\" size=\"small\"></el-input-number>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"开始时间\" width=\"150\">\n          <template slot-scope=\"scope\">\n            <el-time-picker\n              v-model=\"scope.row.startTime\"\n              format=\"HH:mm:ss\"\n              value-format=\"HH:mm:ss\"\n              placeholder=\"选择开始时间\">\n            </el-time-picker>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"结束时间\" width=\"150\">\n          <template slot-scope=\"scope\">\n            <el-time-picker\n              v-model=\"scope.row.endTime\"\n              format=\"HH:mm:ss\"\n              value-format=\"HH:mm:ss\"\n              placeholder=\"选择结束时间\">\n            </el-time-picker>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" width=\"100\">\n          <template slot-scope=\"scope\">\n            <el-button @click=\"removeClip(scope.$index)\" type=\"danger\" size=\"mini\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      <div style=\"margin-top: 20px; text-align: center;\">\n        <el-button type=\"primary\" @click=\"submitProcessTask\" :loading=\"processing\">提交处理任务</el-button>\n      </div>\n    </el-card>\n    \n    <el-card class=\"task-card\" v-if=\"taskId\">\n      <div slot=\"header\">\n        <span>处理任务状态</span>\n      </div>\n      <el-descriptions :column=\"1\" border>\n        <el-descriptions-item label=\"任务ID\">{{ taskId }}</el-descriptions-item>\n        <el-descriptions-item label=\"任务名称\">{{ taskInfo.taskName || '获取中...' }}</el-descriptions-item>\n        <el-descriptions-item label=\"状态\">\n          <el-tag :type=\"getProcessStatusType(taskInfo.status)\">\n            {{ getProcessStatusText(taskInfo.status) }}\n          </el-tag>\n        </el-descriptions-item>\n        <el-descriptions-item label=\"进度\">\n          <el-progress :percentage=\"taskInfo.progress || 0\"></el-progress>\n        </el-descriptions-item>\n        <el-descriptions-item label=\"投稿状态\">\n          <el-tag :type=\"getUploadStatusType(taskInfo.uploadStatus)\">\n            {{ getUploadStatusText(taskInfo.uploadStatus) }}\n          </el-tag>\n        </el-descriptions-item>\n        <el-descriptions-item label=\"视频链接\" v-if=\"taskInfo.bilibiliUrl\">\n          <a :href=\"taskInfo.bilibiliUrl\" target=\"_blank\">{{ taskInfo.bilibiliUrl }}</a>\n        </el-descriptions-item>\n      </el-descriptions>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { createProcessTask, getProcessStatus } from '@/api/video'\n\nexport default {\n  name: 'VideoProcessor',\n  data() {\n    return {\n      processForm: {\n        taskName: ''\n      },\n      fileList: [],\n      clips: [],\n      processing: false,\n      taskId: null,\n      taskInfo: {}\n    }\n  },\n  watch: {\n    taskId: {\n      handler(newVal) {\n        if (newVal) {\n          this.startPolling()\n        }\n      }\n    }\n  },\n  methods: {\n    // 处理文件变化\n    handleFileChange(file, fileList) {\n      this.fileList = fileList\n      // 添加到片段列表\n      const clip = {\n        fileName: file.name,\n        sequence: this.clips.length + 1,\n        startTime: '00:00:00',\n        endTime: '00:00:00'\n      }\n      this.clips.push(clip)\n    },\n    \n    // 删除片段\n    removeClip(index) {\n      this.clips.splice(index, 1)\n      // 重新排序序号\n      this.clips.forEach((clip, i) => {\n        clip.sequence = i + 1\n      })\n    },\n    \n    // 提交处理任务\n    async submitProcessTask() {\n      if (!this.processForm.taskName) {\n        this.$message.warning('请输入任务名称')\n        return\n      }\n      \n      if (this.clips.length === 0) {\n        this.$message.warning('请至少选择一个视频文件')\n        return\n      }\n      \n      this.processing = true\n      try {\n        // 转换时间格式\n        const clips = this.clips.map(clip => ({\n          ...clip,\n          startTime: clip.startTime || '00:00:00',\n          endTime: clip.endTime || '00:00:00'\n        }))\n        \n        const response = await createProcessTask({\n          taskName: this.processForm.taskName,\n          clips: clips\n        })\n        \n        if (response.code === 0) {\n          this.$message.success('处理任务创建成功')\n          this.taskId = response.data\n          this.taskInfo = {}\n        } else {\n          this.$message.error(response.message)\n        }\n      } catch (error) {\n        this.$message.error('创建处理任务失败: ' + error.message)\n      } finally {\n        this.processing = false\n      }\n    },\n    \n    // 开始轮询任务状态\n    startPolling() {\n      this.pollingTimer = setInterval(async () => {\n        try {\n          const response = await getProcessStatus(this.taskId)\n          if (response.code === 0) {\n            this.taskInfo = response.data\n            // 如果任务完成或失败，停止轮询\n            if (this.taskInfo.status === 2 || this.taskInfo.status === 3) {\n              clearInterval(this.pollingTimer)\n            }\n          }\n        } catch (error) {\n          console.error('获取任务状态失败:', error)\n        }\n      }, 3000) // 每3秒查询一次\n    },\n    \n    // 获取处理状态文本\n    getProcessStatusText(status) {\n      const statusMap = {\n        0: '待处理',\n        1: '处理中',\n        2: '处理完成',\n        3: '处理失败'\n      }\n      return statusMap[status] || '未知'\n    },\n    \n    // 获取处理状态类型\n    getProcessStatusType(status) {\n      const typeMap = {\n        0: 'info',\n        1: 'warning',\n        2: 'success',\n        3: 'danger'\n      }\n      return typeMap[status] || 'info'\n    },\n    \n    // 获取投稿状态文本\n    getUploadStatusText(status) {\n      const statusMap = {\n        0: '未投稿',\n        1: '投稿中',\n        2: '投稿成功',\n        3: '投稿失败'\n      }\n      return statusMap[status] || '未知'\n    },\n    \n    // 获取投稿状态类型\n    getUploadStatusType(status) {\n      const typeMap = {\n        0: 'info',\n        1: 'warning',\n        2: 'success',\n        3: 'danger'\n      }\n      return typeMap[status] || 'info'\n    }\n  },\n  \n  beforeDestroy() {\n    // 组件销毁前清除定时器\n    if (this.pollingTimer) {\n      clearInterval(this.pollingTimer)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.video-processor {\n  padding: 20px;\n}\n\n.input-card, .clip-card, .task-card {\n  margin-bottom: 20px;\n}\n</style>"]}]}