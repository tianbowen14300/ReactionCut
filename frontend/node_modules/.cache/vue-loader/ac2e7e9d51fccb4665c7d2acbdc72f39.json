{"remainingRequest":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tbw/work/btProject/reaction-cut/frontend/src/views/AnchorSubscription.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/src/views/AnchorSubscription.vue","mtime":1761391253087},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/babel-loader@8.4.1_@babel+core@7.28.5_webpack@4.47.0/node_modules/babel-loader/lib/index.js","mtime":1761026722096},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js","mtime":1761026704427}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IHN1YnNjcmliZUFuY2hvcnMsIGdldEFsbEFuY2hvcnMsIGNoZWNrTGl2ZVN0YXR1cyB9IGZyb20gJ0AvYXBpL2FuY2hvcicKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQW5jaG9yU3Vic2NyaXB0aW9uJywKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgYW5jaG9yTGlzdDogW10sCiAgICAgIG5ld0FuY2hvclVpZDogJycsCiAgICAgIGFkZGluZ0FuY2hvcjogZmFsc2UKICAgIH0KICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmxvYWRBbmNob3JMaXN0KCkKICAgIC8vIOWumuaXtuWIt+aWsOS4u+aSreeKtuaAgQogICAgdGhpcy5zdGF0dXNJbnRlcnZhbCA9IHNldEludGVydmFsKHRoaXMubG9hZEFuY2hvckxpc3QsIDMwMDAwKQogIH0sCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIGlmICh0aGlzLnN0YXR1c0ludGVydmFsKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5zdGF0dXNJbnRlcnZhbCkKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIOWKoOi9veS4u+aSreWIl+ihqAogICAgYXN5bmMgbG9hZEFuY2hvckxpc3QoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXRBbGxBbmNob3JzKCkKICAgICAgICBpZiAocmVzcG9uc2UuY29kZSA9PT0gMjAwKSB7CiAgICAgICAgICB0aGlzLmFuY2hvckxpc3QgPSByZXNwb25zZS5kYXRhIHx8IFtdCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzcG9uc2UubWVzc2FnZSkKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5Yqg6L295Li75pKt5YiX6KGo5aSx6LSlOiAnICsgZXJyb3IubWVzc2FnZSkKICAgICAgfQogICAgfSwKICAgIAogICAgLy8g6K6i6ZiF5paw5Li75pKtCiAgICBhc3luYyBzdWJzY3JpYmVOZXdBbmNob3IoKSB7CiAgICAgIGlmICghdGhpcy5uZXdBbmNob3JVaWQpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+ivt+i+k+WFpeaIv+mXtOWPt+aIlumTvuaOpScpCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgCiAgICAgIHRoaXMuYWRkaW5nQW5jaG9yID0gdHJ1ZQogICAgICB0cnkgewogICAgICAgIC8vIOino+aekOaIv+mXtOWPt++8iOWmguaenOaYr+mTvuaOpeeahOivne+8iQogICAgICAgIGNvbnN0IHVpZCA9IHRoaXMuZXh0cmFjdFVpZEZyb21JbnB1dCh0aGlzLm5ld0FuY2hvclVpZCkKICAgICAgICBpZiAoIXVpZCkgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5peg5rOV6Kej5p6Q5oi/6Ze05Y+3JykKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHN1YnNjcmliZUFuY2hvcnMoeyB1aWRzOiBbdWlkXSB9KQogICAgICAgIGlmIChyZXNwb25zZS5jb2RlID09PSAyMDApIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn6K6i6ZiF5oiQ5YqfJykKICAgICAgICAgIHRoaXMubmV3QW5jaG9yVWlkID0gJycKICAgICAgICAgIHRoaXMubG9hZEFuY2hvckxpc3QoKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlc3BvbnNlLm1lc3NhZ2UpCiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+iuoumYheWksei0pTogJyArIGVycm9yLm1lc3NhZ2UpCiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdGhpcy5hZGRpbmdBbmNob3IgPSBmYWxzZQogICAgICB9CiAgICB9LAogICAgCiAgICAvLyDku47ovpPlhaXkuK3mj5Dlj5bmiL/pl7Tlj7cKICAgIGV4dHJhY3RVaWRGcm9tSW5wdXQoaW5wdXQpIHsKICAgICAgLy8g5aaC5p6c5piv57qv5pWw5a2X77yM55u05o6l6L+U5ZueCiAgICAgIGlmICgvXlxkKyQvLnRlc3QoaW5wdXQpKSB7CiAgICAgICAgcmV0dXJuIGlucHV0CiAgICAgIH0KICAgICAgCiAgICAgIC8vIOWmguaenOaYr+mTvuaOpe+8jOWwneivleaPkOWPluaIv+mXtOWPtwogICAgICBjb25zdCBtYXRjaCA9IGlucHV0Lm1hdGNoKC9saXZlXC5iaWxpYmlsaVwuY29tXC8oXGQrKS8pCiAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSkgewogICAgICAgIHJldHVybiBtYXRjaFsxXQogICAgICB9CiAgICAgIAogICAgICByZXR1cm4gaW5wdXQKICAgIH0sCiAgICAKICAgIC8vIOWkhOeQhuS4u+aSreaTjeS9nOWRveS7pAogICAgaGFuZGxlQW5jaG9yQ29tbWFuZChjb21tYW5kKSB7CiAgICAgIGNvbnN0IHsgYWN0aW9uLCBhbmNob3IgfSA9IGNvbW1hbmQKICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICBjYXNlICd1bnN1YnNjcmliZSc6CiAgICAgICAgICB0aGlzLnVuc3Vic2NyaWJlQW5jaG9yKGFuY2hvcikKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnc3RhcnRSZWNvcmQnOgogICAgICAgICAgdGhpcy5zdGFydFJlY29yZChhbmNob3IpCiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ3N0b3BSZWNvcmQnOgogICAgICAgICAgdGhpcy5zdG9wUmVjb3JkKGFuY2hvcikKICAgICAgICAgIGJyZWFrCiAgICAgIH0KICAgIH0sCiAgICAKICAgIC8vIOWPlua2iOiuoumYhQogICAgYXN5bmMgdW5zdWJzY3JpYmVBbmNob3IoYW5jaG9yKSB7CiAgICAgIHRoaXMuJGNvbmZpcm0oYOehruWumuimgeWPlua2iOiuoumYheS4u+aSrSAke2FuY2hvci5uaWNrbmFtZSB8fCBhbmNob3IudWlkfSDlkJfvvJ9gLCAn5o+Q56S6JywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgfSkudGhlbihhc3luYyAoKSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIC8vIOi/memHjOW6lOivpeiwg+eUqOWPlua2iOiuoumYheeahEFQSQogICAgICAgICAgLy8g55Sx5LqO5ZCO56uv5pqC5pyq5o+Q5L6b6K+l5o6l5Y+j77yM5oiR5Lus5pqC5pe25Y+q5Zyo5YmN56uv56e76ZmkCiAgICAgICAgICB0aGlzLmFuY2hvckxpc3QgPSB0aGlzLmFuY2hvckxpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS5pZCAhPT0gYW5jaG9yLmlkKQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCflj5bmtojorqLpmIXmiJDlip8nKQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCflj5bmtojorqLpmIXlpLHotKU6ICcgKyBlcnJvci5tZXNzYWdlKQogICAgICAgIH0KICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgIC8vIOeUqOaIt+WPlua2iOaTjeS9nAogICAgICB9KQogICAgfSwKICAgIAogICAgLy8g5byA5aeL5b2V5Yi2CiAgICBzdGFydFJlY29yZChhbmNob3IpIHsKICAgICAgdGhpcy4kbWVzc2FnZS5pbmZvKGDlvIDlp4vlvZXliLbkuLvmkq0gJHthbmNob3Iubmlja25hbWUgfHwgYW5jaG9yLnVpZH1gKQogICAgICAvLyDov5nph4zlupTor6XosIPnlKjlvIDlp4vlvZXliLbnmoRBUEkKICAgIH0sCiAgICAKICAgIC8vIOWBnOatouW9leWItgogICAgc3RvcFJlY29yZChhbmNob3IpIHsKICAgICAgdGhpcy4kbWVzc2FnZS5pbmZvKGDlgZzmraLlvZXliLbkuLvmkq0gJHthbmNob3Iubmlja25hbWUgfHwgYW5jaG9yLnVpZH1gKQogICAgICAvLyDov5nph4zlupTor6XosIPnlKjlgZzmraLlvZXliLbnmoRBUEkKICAgIH0sCiAgICAKICAgIC8vIOiOt+WPlum7mOiupOWktOWDjwogICAgZ2V0RGVmYXVsdEF2YXRhcigpIHsKICAgICAgcmV0dXJuICdodHRwczovL3N0YXRpYy5oZHNsYi5jb20vaW1hZ2VzL21lbWJlci9ub2ZhY2UuZ2lmJwogICAgfQogIH0KfQo="},{"version":3,"sources":["AnchorSubscription.vue"],"names":[],"mappings":";AA6EA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"AnchorSubscription.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"anchor-subscription\">\n    <h2>主播订阅管理</h2>\n    \n    <div class=\"anchor-grid\">\n      <!-- 已订阅主播方块 -->\n      <div \n        class=\"anchor-card\" \n        v-for=\"anchor in anchorList\" \n        :key=\"anchor.id\"\n      >\n        <div class=\"anchor-header\">\n          <img \n            :src=\"anchor.avatar || getDefaultAvatar()\" \n            :alt=\"anchor.nickname\" \n            class=\"anchor-avatar\"\n          >\n          <div class=\"anchor-info\">\n            <div class=\"anchor-name\">{{ anchor.nickname || '未知主播' }}</div>\n            <div class=\"anchor-uid\">房间号: {{ anchor.uid }}</div>\n          </div>\n          <el-dropdown @command=\"handleAnchorCommand\" trigger=\"click\">\n            <span class=\"el-dropdown-link\">\n              <i class=\"el-icon-more\"></i>\n            </span>\n            <el-dropdown-menu slot=\"dropdown\">\n              <el-dropdown-item :command=\"{action: 'unsubscribe', anchor: anchor}\">\n                取消订阅\n              </el-dropdown-item>\n              <el-dropdown-item :command=\"{action: 'startRecord', anchor: anchor}\" v-if=\"anchor.liveStatus !== 1\">\n                开始录制\n              </el-dropdown-item>\n              <el-dropdown-item :command=\"{action: 'stopRecord', anchor: anchor}\" v-if=\"anchor.liveStatus === 1\">\n                停止录制\n              </el-dropdown-item>\n            </el-dropdown-menu>\n          </el-dropdown>\n        </div>\n        \n        <div class=\"anchor-status\">\n          <el-tag :type=\"anchor.liveStatus === 1 ? 'success' : 'info'\">\n            {{ anchor.liveStatus === 1 ? '直播中' : '未直播' }}\n          </el-tag>\n        </div>\n        \n        <div class=\"anchor-details\" v-if=\"anchor.liveStatus === 1\">\n          <div class=\"live-title\">{{ anchor.liveTitle || '直播标题' }}</div>\n          <div class=\"live-category\">{{ anchor.category || '未知分区' }}</div>\n        </div>\n      </div>\n      \n      <!-- 添加主播方块 -->\n      <div class=\"anchor-card add-card\">\n        <div class=\"add-content\">\n          <i class=\"el-icon-plus add-icon\"></i>\n          <div class=\"add-text\">添加房间</div>\n          <el-input \n            v-model=\"newAnchorUid\" \n            placeholder=\"请输入房间号或链接\"\n            size=\"small\"\n            style=\"width: 100%; margin: 10px 0;\"\n          ></el-input>\n          <el-button \n            type=\"primary\" \n            size=\"small\" \n            @click=\"subscribeNewAnchor\"\n            :loading=\"addingAnchor\"\n          >\n            确定\n          </el-button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { subscribeAnchors, getAllAnchors, checkLiveStatus } from '@/api/anchor'\n\nexport default {\n  name: 'AnchorSubscription',\n  data() {\n    return {\n      anchorList: [],\n      newAnchorUid: '',\n      addingAnchor: false\n    }\n  },\n  mounted() {\n    this.loadAnchorList()\n    // 定时刷新主播状态\n    this.statusInterval = setInterval(this.loadAnchorList, 30000)\n  },\n  beforeDestroy() {\n    if (this.statusInterval) {\n      clearInterval(this.statusInterval)\n    }\n  },\n  methods: {\n    // 加载主播列表\n    async loadAnchorList() {\n      try {\n        const response = await getAllAnchors()\n        if (response.code === 200) {\n          this.anchorList = response.data || []\n        } else {\n          this.$message.error(response.message)\n        }\n      } catch (error) {\n        this.$message.error('加载主播列表失败: ' + error.message)\n      }\n    },\n    \n    // 订阅新主播\n    async subscribeNewAnchor() {\n      if (!this.newAnchorUid) {\n        this.$message.warning('请输入房间号或链接')\n        return\n      }\n      \n      this.addingAnchor = true\n      try {\n        // 解析房间号（如果是链接的话）\n        const uid = this.extractUidFromInput(this.newAnchorUid)\n        if (!uid) {\n          this.$message.error('无法解析房间号')\n          return\n        }\n        \n        const response = await subscribeAnchors({ uids: [uid] })\n        if (response.code === 200) {\n          this.$message.success('订阅成功')\n          this.newAnchorUid = ''\n          this.loadAnchorList()\n        } else {\n          this.$message.error(response.message)\n        }\n      } catch (error) {\n        this.$message.error('订阅失败: ' + error.message)\n      } finally {\n        this.addingAnchor = false\n      }\n    },\n    \n    // 从输入中提取房间号\n    extractUidFromInput(input) {\n      // 如果是纯数字，直接返回\n      if (/^\\d+$/.test(input)) {\n        return input\n      }\n      \n      // 如果是链接，尝试提取房间号\n      const match = input.match(/live\\.bilibili\\.com\\/(\\d+)/)\n      if (match && match[1]) {\n        return match[1]\n      }\n      \n      return input\n    },\n    \n    // 处理主播操作命令\n    handleAnchorCommand(command) {\n      const { action, anchor } = command\n      switch (action) {\n        case 'unsubscribe':\n          this.unsubscribeAnchor(anchor)\n          break\n        case 'startRecord':\n          this.startRecord(anchor)\n          break\n        case 'stopRecord':\n          this.stopRecord(anchor)\n          break\n      }\n    },\n    \n    // 取消订阅\n    async unsubscribeAnchor(anchor) {\n      this.$confirm(`确定要取消订阅主播 ${anchor.nickname || anchor.uid} 吗？`, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        try {\n          // 这里应该调用取消订阅的API\n          // 由于后端暂未提供该接口，我们暂时只在前端移除\n          this.anchorList = this.anchorList.filter(item => item.id !== anchor.id)\n          this.$message.success('取消订阅成功')\n        } catch (error) {\n          this.$message.error('取消订阅失败: ' + error.message)\n        }\n      }).catch(() => {\n        // 用户取消操作\n      })\n    },\n    \n    // 开始录制\n    startRecord(anchor) {\n      this.$message.info(`开始录制主播 ${anchor.nickname || anchor.uid}`)\n      // 这里应该调用开始录制的API\n    },\n    \n    // 停止录制\n    stopRecord(anchor) {\n      this.$message.info(`停止录制主播 ${anchor.nickname || anchor.uid}`)\n      // 这里应该调用停止录制的API\n    },\n    \n    // 获取默认头像\n    getDefaultAvatar() {\n      return 'https://static.hdslb.com/images/member/noface.gif'\n    }\n  }\n}\n</script>\n\n<style scoped>\n.anchor-subscription {\n  padding: 20px;\n}\n\n.anchor-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n  gap: 20px;\n}\n\n.anchor-card {\n  border: 1px solid #ebeef5;\n  border-radius: 8px;\n  padding: 15px;\n  background-color: #fff;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n  transition: box-shadow 0.3s;\n}\n\n.anchor-card:hover {\n  box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.15);\n}\n\n.anchor-header {\n  display: flex;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.anchor-avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  margin-right: 10px;\n}\n\n.anchor-info {\n  flex: 1;\n}\n\n.anchor-name {\n  font-weight: bold;\n  font-size: 14px;\n}\n\n.anchor-uid {\n  font-size: 12px;\n  color: #909399;\n}\n\n.el-dropdown-link {\n  cursor: pointer;\n  color: #409EFF;\n}\n\n.anchor-status {\n  margin-bottom: 10px;\n}\n\n.anchor-details {\n  font-size: 12px;\n  color: #606266;\n}\n\n.live-title {\n  margin-bottom: 5px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.add-card {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: #f5f7fa;\n  cursor: pointer;\n}\n\n.add-content {\n  text-align: center;\n  width: 100%;\n}\n\n.add-icon {\n  font-size: 36px;\n  color: #909399;\n  margin-bottom: 10px;\n}\n\n.add-text {\n  font-size: 14px;\n  color: #909399;\n  margin-bottom: 10px;\n}\n</style>"]}]}