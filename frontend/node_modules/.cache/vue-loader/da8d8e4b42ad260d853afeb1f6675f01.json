{"remainingRequest":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tbw/work/btProject/reaction-cut/frontend/src/views/AnchorSubscription.vue?vue&type=style&index=0&id=15c06f2c&scoped=true&lang=css","dependencies":[{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/src/views/AnchorSubscription.vue","mtime":1761391253087},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/css-loader@3.6.0_webpack@5.102.1/node_modules/css-loader/dist/cjs.js","mtime":1762013131130},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1761026704430},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js","mtime":1762013131924},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js","mtime":1761026704427}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5hbmNob3Itc3Vic2NyaXB0aW9uIHsKICBwYWRkaW5nOiAyMHB4Owp9CgouYW5jaG9yLWdyaWQgewogIGRpc3BsYXk6IGdyaWQ7CiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoYXV0by1maWxsLCBtaW5tYXgoMjUwcHgsIDFmcikpOwogIGdhcDogMjBweDsKfQoKLmFuY2hvci1jYXJkIHsKICBib3JkZXI6IDFweCBzb2xpZCAjZWJlZWY1OwogIGJvcmRlci1yYWRpdXM6IDhweDsKICBwYWRkaW5nOiAxNXB4OwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgYm94LXNoYWRvdzogMCAycHggMTJweCAwIHJnYmEoMCwgMCwgMCwgMC4xKTsKICB0cmFuc2l0aW9uOiBib3gtc2hhZG93IDAuM3M7Cn0KCi5hbmNob3ItY2FyZDpob3ZlciB7CiAgYm94LXNoYWRvdzogMCA0cHggMjBweCAwIHJnYmEoMCwgMCwgMCwgMC4xNSk7Cn0KCi5hbmNob3ItaGVhZGVyIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKfQoKLmFuY2hvci1hdmF0YXIgewogIHdpZHRoOiA0MHB4OwogIGhlaWdodDogNDBweDsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgbWFyZ2luLXJpZ2h0OiAxMHB4Owp9CgouYW5jaG9yLWluZm8gewogIGZsZXg6IDE7Cn0KCi5hbmNob3ItbmFtZSB7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgZm9udC1zaXplOiAxNHB4Owp9CgouYW5jaG9yLXVpZCB7CiAgZm9udC1zaXplOiAxMnB4OwogIGNvbG9yOiAjOTA5Mzk5Owp9CgouZWwtZHJvcGRvd24tbGluayB7CiAgY3Vyc29yOiBwb2ludGVyOwogIGNvbG9yOiAjNDA5RUZGOwp9CgouYW5jaG9yLXN0YXR1cyB7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKfQoKLmFuY2hvci1kZXRhaWxzIHsKICBmb250LXNpemU6IDEycHg7CiAgY29sb3I6ICM2MDYyNjY7Cn0KCi5saXZlLXRpdGxlIHsKICBtYXJnaW4tYm90dG9tOiA1cHg7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICBvdmVyZmxvdzogaGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwp9CgouYWRkLWNhcmQgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmN2ZhOwogIGN1cnNvcjogcG9pbnRlcjsKfQoKLmFkZC1jb250ZW50IHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgd2lkdGg6IDEwMCU7Cn0KCi5hZGQtaWNvbiB7CiAgZm9udC1zaXplOiAzNnB4OwogIGNvbG9yOiAjOTA5Mzk5OwogIG1hcmdpbi1ib3R0b206IDEwcHg7Cn0KCi5hZGQtdGV4dCB7CiAgZm9udC1zaXplOiAxNHB4OwogIGNvbG9yOiAjOTA5Mzk5OwogIG1hcmdpbi1ib3R0b206IDEwcHg7Cn0K"},{"version":3,"sources":["AnchorSubscription.vue"],"names":[],"mappings":";AAyNA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"AnchorSubscription.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"anchor-subscription\">\n    <h2>主播订阅管理</h2>\n    \n    <div class=\"anchor-grid\">\n      <!-- 已订阅主播方块 -->\n      <div \n        class=\"anchor-card\" \n        v-for=\"anchor in anchorList\" \n        :key=\"anchor.id\"\n      >\n        <div class=\"anchor-header\">\n          <img \n            :src=\"anchor.avatar || getDefaultAvatar()\" \n            :alt=\"anchor.nickname\" \n            class=\"anchor-avatar\"\n          >\n          <div class=\"anchor-info\">\n            <div class=\"anchor-name\">{{ anchor.nickname || '未知主播' }}</div>\n            <div class=\"anchor-uid\">房间号: {{ anchor.uid }}</div>\n          </div>\n          <el-dropdown @command=\"handleAnchorCommand\" trigger=\"click\">\n            <span class=\"el-dropdown-link\">\n              <i class=\"el-icon-more\"></i>\n            </span>\n            <el-dropdown-menu slot=\"dropdown\">\n              <el-dropdown-item :command=\"{action: 'unsubscribe', anchor: anchor}\">\n                取消订阅\n              </el-dropdown-item>\n              <el-dropdown-item :command=\"{action: 'startRecord', anchor: anchor}\" v-if=\"anchor.liveStatus !== 1\">\n                开始录制\n              </el-dropdown-item>\n              <el-dropdown-item :command=\"{action: 'stopRecord', anchor: anchor}\" v-if=\"anchor.liveStatus === 1\">\n                停止录制\n              </el-dropdown-item>\n            </el-dropdown-menu>\n          </el-dropdown>\n        </div>\n        \n        <div class=\"anchor-status\">\n          <el-tag :type=\"anchor.liveStatus === 1 ? 'success' : 'info'\">\n            {{ anchor.liveStatus === 1 ? '直播中' : '未直播' }}\n          </el-tag>\n        </div>\n        \n        <div class=\"anchor-details\" v-if=\"anchor.liveStatus === 1\">\n          <div class=\"live-title\">{{ anchor.liveTitle || '直播标题' }}</div>\n          <div class=\"live-category\">{{ anchor.category || '未知分区' }}</div>\n        </div>\n      </div>\n      \n      <!-- 添加主播方块 -->\n      <div class=\"anchor-card add-card\">\n        <div class=\"add-content\">\n          <i class=\"el-icon-plus add-icon\"></i>\n          <div class=\"add-text\">添加房间</div>\n          <el-input \n            v-model=\"newAnchorUid\" \n            placeholder=\"请输入房间号或链接\"\n            size=\"small\"\n            style=\"width: 100%; margin: 10px 0;\"\n          ></el-input>\n          <el-button \n            type=\"primary\" \n            size=\"small\" \n            @click=\"subscribeNewAnchor\"\n            :loading=\"addingAnchor\"\n          >\n            确定\n          </el-button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { subscribeAnchors, getAllAnchors, checkLiveStatus } from '@/api/anchor'\n\nexport default {\n  name: 'AnchorSubscription',\n  data() {\n    return {\n      anchorList: [],\n      newAnchorUid: '',\n      addingAnchor: false\n    }\n  },\n  mounted() {\n    this.loadAnchorList()\n    // 定时刷新主播状态\n    this.statusInterval = setInterval(this.loadAnchorList, 30000)\n  },\n  beforeDestroy() {\n    if (this.statusInterval) {\n      clearInterval(this.statusInterval)\n    }\n  },\n  methods: {\n    // 加载主播列表\n    async loadAnchorList() {\n      try {\n        const response = await getAllAnchors()\n        if (response.code === 200) {\n          this.anchorList = response.data || []\n        } else {\n          this.$message.error(response.message)\n        }\n      } catch (error) {\n        this.$message.error('加载主播列表失败: ' + error.message)\n      }\n    },\n    \n    // 订阅新主播\n    async subscribeNewAnchor() {\n      if (!this.newAnchorUid) {\n        this.$message.warning('请输入房间号或链接')\n        return\n      }\n      \n      this.addingAnchor = true\n      try {\n        // 解析房间号（如果是链接的话）\n        const uid = this.extractUidFromInput(this.newAnchorUid)\n        if (!uid) {\n          this.$message.error('无法解析房间号')\n          return\n        }\n        \n        const response = await subscribeAnchors({ uids: [uid] })\n        if (response.code === 200) {\n          this.$message.success('订阅成功')\n          this.newAnchorUid = ''\n          this.loadAnchorList()\n        } else {\n          this.$message.error(response.message)\n        }\n      } catch (error) {\n        this.$message.error('订阅失败: ' + error.message)\n      } finally {\n        this.addingAnchor = false\n      }\n    },\n    \n    // 从输入中提取房间号\n    extractUidFromInput(input) {\n      // 如果是纯数字，直接返回\n      if (/^\\d+$/.test(input)) {\n        return input\n      }\n      \n      // 如果是链接，尝试提取房间号\n      const match = input.match(/live\\.bilibili\\.com\\/(\\d+)/)\n      if (match && match[1]) {\n        return match[1]\n      }\n      \n      return input\n    },\n    \n    // 处理主播操作命令\n    handleAnchorCommand(command) {\n      const { action, anchor } = command\n      switch (action) {\n        case 'unsubscribe':\n          this.unsubscribeAnchor(anchor)\n          break\n        case 'startRecord':\n          this.startRecord(anchor)\n          break\n        case 'stopRecord':\n          this.stopRecord(anchor)\n          break\n      }\n    },\n    \n    // 取消订阅\n    async unsubscribeAnchor(anchor) {\n      this.$confirm(`确定要取消订阅主播 ${anchor.nickname || anchor.uid} 吗？`, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        try {\n          // 这里应该调用取消订阅的API\n          // 由于后端暂未提供该接口，我们暂时只在前端移除\n          this.anchorList = this.anchorList.filter(item => item.id !== anchor.id)\n          this.$message.success('取消订阅成功')\n        } catch (error) {\n          this.$message.error('取消订阅失败: ' + error.message)\n        }\n      }).catch(() => {\n        // 用户取消操作\n      })\n    },\n    \n    // 开始录制\n    startRecord(anchor) {\n      this.$message.info(`开始录制主播 ${anchor.nickname || anchor.uid}`)\n      // 这里应该调用开始录制的API\n    },\n    \n    // 停止录制\n    stopRecord(anchor) {\n      this.$message.info(`停止录制主播 ${anchor.nickname || anchor.uid}`)\n      // 这里应该调用停止录制的API\n    },\n    \n    // 获取默认头像\n    getDefaultAvatar() {\n      return 'https://static.hdslb.com/images/member/noface.gif'\n    }\n  }\n}\n</script>\n\n<style scoped>\n.anchor-subscription {\n  padding: 20px;\n}\n\n.anchor-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n  gap: 20px;\n}\n\n.anchor-card {\n  border: 1px solid #ebeef5;\n  border-radius: 8px;\n  padding: 15px;\n  background-color: #fff;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n  transition: box-shadow 0.3s;\n}\n\n.anchor-card:hover {\n  box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.15);\n}\n\n.anchor-header {\n  display: flex;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.anchor-avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  margin-right: 10px;\n}\n\n.anchor-info {\n  flex: 1;\n}\n\n.anchor-name {\n  font-weight: bold;\n  font-size: 14px;\n}\n\n.anchor-uid {\n  font-size: 12px;\n  color: #909399;\n}\n\n.el-dropdown-link {\n  cursor: pointer;\n  color: #409EFF;\n}\n\n.anchor-status {\n  margin-bottom: 10px;\n}\n\n.anchor-details {\n  font-size: 12px;\n  color: #606266;\n}\n\n.live-title {\n  margin-bottom: 5px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.add-card {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: #f5f7fa;\n  cursor: pointer;\n}\n\n.add-content {\n  text-align: center;\n  width: 100%;\n}\n\n.add-icon {\n  font-size: 36px;\n  color: #909399;\n  margin-bottom: 10px;\n}\n\n.add-text {\n  font-size: 14px;\n  color: #909399;\n  margin-bottom: 10px;\n}\n</style>"]}]}