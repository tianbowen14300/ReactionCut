{"remainingRequest":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tbw/work/btProject/reaction-cut/frontend/src/views/VideoProcessor.vue?vue&type=style&index=0&id=68aa00de&scoped=true&lang=css","dependencies":[{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/src/views/VideoProcessor.vue","mtime":1762077994469},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/css-loader@3.6.0_webpack@5.102.1/node_modules/css-loader/dist/cjs.js","mtime":1762013131130},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1761026704430},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js","mtime":1762013131924},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js","mtime":1761026704427}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci52aWRlby1wcm9jZXNzb3IgewogIHBhZGRpbmc6IDIwcHg7Cn0KCi5pbnB1dC1jYXJkLCAuY2xpcC1jYXJkLCAudGFzay1jYXJkIHsKICBtYXJnaW4tYm90dG9tOiAyMHB4Owp9Cg=="},{"version":3,"sources":["VideoProcessor.vue"],"names":[],"mappings":";AAwQA;AACA;AACA;;AAEA;AACA;AACA","file":"VideoProcessor.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"video-processor\">\n    <h2>视频处理与投稿</h2>\n    \n    <el-card class=\"input-card\">\n      <div slot=\"header\">\n        <span>处理任务配置</span>\n      </div>\n      <el-form :model=\"processForm\" ref=\"processForm\" label-width=\"100px\">\n        <el-form-item label=\"任务名称\">\n          <el-input \n            v-model=\"processForm.taskName\" \n            placeholder=\"请输入任务名称\"\n            style=\"width: 300px;\"\n          ></el-input>\n        </el-form-item>\n        \n        <el-form-item label=\"视频文件\">\n          <el-upload\n            action=\"#\"\n            :auto-upload=\"false\"\n            :file-list=\"fileList\"\n            :on-change=\"handleFileChange\"\n            multiple\n          >\n            <el-button slot=\"trigger\" size=\"small\" type=\"primary\">选择文件</el-button>\n            <div slot=\"tip\" class=\"el-upload__tip\">请选择要处理的视频文件</div>\n          </el-upload>\n        </el-form-item>\n      </el-form>\n    </el-card>\n    \n    <el-card class=\"clip-card\" v-if=\"clips.length > 0\">\n      <div slot=\"header\">\n        <span>视频片段设置</span>\n      </div>\n      <el-table :data=\"clips\" style=\"width: 100%\">\n        <el-table-column prop=\"fileName\" label=\"文件名\" width=\"200\"></el-table-column>\n        <el-table-column prop=\"sequence\" label=\"序号\" width=\"80\">\n          <template slot-scope=\"scope\">\n            <el-input-number v-model=\"scope.row.sequence\" :min=\"1\" size=\"small\"></el-input-number>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"开始时间\" width=\"150\">\n          <template slot-scope=\"scope\">\n            <el-time-picker\n              v-model=\"scope.row.startTime\"\n              format=\"HH:mm:ss\"\n              value-format=\"HH:mm:ss\"\n              placeholder=\"选择开始时间\">\n            </el-time-picker>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"结束时间\" width=\"150\">\n          <template slot-scope=\"scope\">\n            <el-time-picker\n              v-model=\"scope.row.endTime\"\n              format=\"HH:mm:ss\"\n              value-format=\"HH:mm:ss\"\n              placeholder=\"选择结束时间\">\n            </el-time-picker>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" width=\"100\">\n          <template slot-scope=\"scope\">\n            <el-button @click=\"removeClip(scope.$index)\" type=\"danger\" size=\"mini\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      <div style=\"margin-top: 20px; text-align: center;\">\n        <el-button type=\"primary\" @click=\"submitProcessTask\" :loading=\"processing\">提交处理任务</el-button>\n      </div>\n    </el-card>\n    \n    <el-card class=\"task-card\" v-if=\"taskId\">\n      <div slot=\"header\">\n        <span>处理任务状态</span>\n      </div>\n      <el-descriptions :column=\"1\" border>\n        <el-descriptions-item label=\"任务ID\">{{ taskId }}</el-descriptions-item>\n        <el-descriptions-item label=\"任务名称\">{{ taskInfo.taskName || '获取中...' }}</el-descriptions-item>\n        <el-descriptions-item label=\"状态\">\n          <el-tag :type=\"getProcessStatusType(taskInfo.status)\">\n            {{ getProcessStatusText(taskInfo.status) }}\n          </el-tag>\n        </el-descriptions-item>\n        <el-descriptions-item label=\"进度\">\n          <el-progress :percentage=\"taskInfo.progress || 0\"></el-progress>\n        </el-descriptions-item>\n        <el-descriptions-item label=\"投稿状态\">\n          <el-tag :type=\"getUploadStatusType(taskInfo.uploadStatus)\">\n            {{ getUploadStatusText(taskInfo.uploadStatus) }}\n          </el-tag>\n        </el-descriptions-item>\n        <el-descriptions-item label=\"视频链接\" v-if=\"taskInfo.bilibiliUrl\">\n          <a :href=\"taskInfo.bilibiliUrl\" target=\"_blank\">{{ taskInfo.bilibiliUrl }}</a>\n        </el-descriptions-item>\n      </el-descriptions>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { createProcessTask, getProcessStatus } from '@/api/video'\n\nexport default {\n  name: 'VideoProcessor',\n  data() {\n    return {\n      processForm: {\n        taskName: ''\n      },\n      fileList: [],\n      clips: [],\n      processing: false,\n      taskId: null,\n      taskInfo: {}\n    }\n  },\n  watch: {\n    taskId: {\n      handler(newVal) {\n        if (newVal) {\n          this.startPolling()\n        }\n      }\n    }\n  },\n  methods: {\n    // 处理文件变化\n    handleFileChange(file, fileList) {\n      this.fileList = fileList\n      // 添加到片段列表\n      const clip = {\n        fileName: file.name,\n        sequence: this.clips.length + 1,\n        startTime: '00:00:00',\n        endTime: '00:00:00'\n      }\n      this.clips.push(clip)\n    },\n    \n    // 删除片段\n    removeClip(index) {\n      this.clips.splice(index, 1)\n      // 重新排序序号\n      this.clips.forEach((clip, i) => {\n        clip.sequence = i + 1\n      })\n    },\n    \n    // 提交处理任务\n    async submitProcessTask() {\n      if (!this.processForm.taskName) {\n        this.$message.warning('请输入任务名称')\n        return\n      }\n      \n      if (this.clips.length === 0) {\n        this.$message.warning('请至少选择一个视频文件')\n        return\n      }\n      \n      this.processing = true\n      try {\n        // 转换时间格式\n        const clips = this.clips.map(clip => ({\n          ...clip,\n          startTime: clip.startTime || '00:00:00',\n          endTime: clip.endTime || '00:00:00'\n        }))\n        \n        const response = await createProcessTask({\n          taskName: this.processForm.taskName,\n          clips: clips\n        })\n        \n        if (response.code === 0) {\n          this.$message.success('处理任务创建成功')\n          this.taskId = response.data\n          this.taskInfo = {}\n        } else {\n          this.$message.error(response.message)\n        }\n      } catch (error) {\n        this.$message.error('创建处理任务失败: ' + error.message)\n      } finally {\n        this.processing = false\n      }\n    },\n    \n    // 开始轮询任务状态\n    startPolling() {\n      this.pollingTimer = setInterval(async () => {\n        try {\n          const response = await getProcessStatus(this.taskId)\n          if (response.code === 0) {\n            this.taskInfo = response.data\n            // 如果任务完成或失败，停止轮询\n            if (this.taskInfo.status === 2 || this.taskInfo.status === 3) {\n              clearInterval(this.pollingTimer)\n            }\n          }\n        } catch (error) {\n          console.error('获取任务状态失败:', error)\n        }\n      }, 3000) // 每3秒查询一次\n    },\n    \n    // 获取处理状态文本\n    getProcessStatusText(status) {\n      const statusMap = {\n        0: '待处理',\n        1: '处理中',\n        2: '处理完成',\n        3: '处理失败'\n      }\n      return statusMap[status] || '未知'\n    },\n    \n    // 获取处理状态类型\n    getProcessStatusType(status) {\n      const typeMap = {\n        0: 'info',\n        1: 'warning',\n        2: 'success',\n        3: 'danger'\n      }\n      return typeMap[status] || 'info'\n    },\n    \n    // 获取投稿状态文本\n    getUploadStatusText(status) {\n      const statusMap = {\n        0: '未投稿',\n        1: '投稿中',\n        2: '投稿成功',\n        3: '投稿失败'\n      }\n      return statusMap[status] || '未知'\n    },\n    \n    // 获取投稿状态类型\n    getUploadStatusType(status) {\n      const typeMap = {\n        0: 'info',\n        1: 'warning',\n        2: 'success',\n        3: 'danger'\n      }\n      return typeMap[status] || 'info'\n    }\n  },\n  \n  beforeDestroy() {\n    // 组件销毁前清除定时器\n    if (this.pollingTimer) {\n      clearInterval(this.pollingTimer)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.video-processor {\n  padding: 20px;\n}\n\n.input-card, .clip-card, .task-card {\n  margin-bottom: 20px;\n}\n</style>"]}]}