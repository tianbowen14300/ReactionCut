{"remainingRequest":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tbw/work/btProject/reaction-cut/frontend/src/components/BiliToolsQRCodeLogin.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/src/components/BiliToolsQRCodeLogin.vue","mtime":1761587089770},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/babel-loader@8.4.1_@babel+core@7.28.5_webpack@4.47.0/node_modules/babel-loader/lib/index.js","mtime":1761026722096},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js","mtime":1761026704427}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IGdlblFyY29kZSwgc2NhbkxvZ2luLCBleGl0TG9naW4gfSBmcm9tICdAL3NlcnZpY2VzL2JpbGliaWxpTG9naW4nCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0JpbGlUb29sc1FSQ29kZUxvZ2luJywKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaXNMb2dpbjogZmFsc2UsCiAgICAgIHNjYW5TdGF0dXM6IC0xLCAvLyAtMjog5Yqg6L295LitLCAtMTog5Yid5aeL5YyWLCA4NjEwMTog5pyq5omr56CBLCA4NjA5MDog5bey5omr5o+P5pyq56Gu6K6kLCA4NjAzODog5LqM57u056CB5bey5aSx5pWILCAwOiDnmbvlvZXmiJDlip8KICAgICAgdXNlcjogewogICAgICAgIGF2YXRhcjogJycsCiAgICAgICAgbmFtZTogJycsCiAgICAgICAgZGVzYzogJycsCiAgICAgICAgdG9wUGhvdG86ICcnLAogICAgICAgIHZpcExhYmVsOiAnJywKICAgICAgICBzdGF0OiB7CiAgICAgICAgICBmb2xsb3dpbmc6IDAsCiAgICAgICAgICBmb2xsb3dlcjogMCwKICAgICAgICAgIGR5bmFtaWM6IDAsCiAgICAgICAgICBjb2luczogMAogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuaW5pdFNjYW4oKQogIH0sCiAgbWV0aG9kczogewogICAgZ2V0U3RhdExhYmVsKGtleSkgewogICAgICBjb25zdCBsYWJlbHMgPSB7CiAgICAgICAgZm9sbG93aW5nOiAn5YWz5rOo5pWwJywKICAgICAgICBmb2xsb3dlcjogJ+eyieS4neaVsCcsCiAgICAgICAgZHluYW1pYzogJ+WKqOaAgeaVsCcsCiAgICAgICAgY29pbnM6ICfnoazluIHmlbAnCiAgICAgIH0KICAgICAgcmV0dXJuIGxhYmVsc1trZXldIHx8IGtleQogICAgfSwKICAgIAogICAgYXN5bmMgaW5pdFNjYW4oKSB7CiAgICAgIGlmICghdGhpcy4kcmVmcy5xcmNvZGVDYW52YXMpIHJldHVybgogICAgICAKICAgICAgdHJ5IHsKICAgICAgICB0aGlzLnNjYW5TdGF0dXMgPSAtMiAvLyDorr7nva7kuLrliqDovb3nirbmgIEKICAgICAgICB0aGlzLiRyZWZzLnFyY29kZUNhbnZhcy5oZWlnaHQgPSAzMDAgLy8g6YeN572uY2FudmFzCiAgICAgICAgCiAgICAgICAgLy8g55Sf5oiQ5LqM57u056CBCiAgICAgICAgY29uc3Qga2V5ID0gYXdhaXQgZ2VuUXJjb2RlKHRoaXMuJHJlZnMucXJjb2RlQ2FudmFzKQogICAgICAgIHRoaXMuc2NhblN0YXR1cyA9IC0xIC8vIOiuvue9ruS4uuWIneWni+eKtuaAgQogICAgICAgIAogICAgICAgIC8vIOW8gOWni+i9ruivouaJq+eggeeKtuaAgQogICAgICAgIGNvbnN0IHN0YXR1cyA9IGF3YWl0IHNjYW5Mb2dpbihrZXksIChjb2RlKSA9PiB7CiAgICAgICAgICB0aGlzLnNjYW5TdGF0dXMgPSBjb2RlCiAgICAgICAgfSkKICAgICAgICAKICAgICAgICAvLyDms6jmhI/vvJpzY2FuTG9naW7lnKjnmbvlvZXmiJDlip/ml7bkvJrov5Tlm54w5bm257uT5p2f5omn6KGMCiAgICAgICAgaWYgKHN0YXR1cyA9PT0gMCkgewogICAgICAgICAgLy8g55m75b2V5oiQ5YqfCiAgICAgICAgICB0aGlzLnNjYW5TdGF0dXMgPSAwCiAgICAgICAgICB0aGlzLmlzTG9naW4gPSB0cnVlCiAgICAgICAgICB0aGlzLmZldGNoVXNlckluZm8oKQogICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSA4NjAzOCkgewogICAgICAgICAgLy8g5LqM57u056CB5bey5aSx5pWICiAgICAgICAgICB0aGlzLnNjYW5TdGF0dXMgPSA4NjAzOAogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliJ3lp4vljJbmiavnoIHlpLHotKU6JywgZXJyb3IpCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5Yid5aeL5YyW5omr56CB5aSx6LSlOiAnICsgZXJyb3IubWVzc2FnZSkKICAgICAgfQogICAgfSwKICAgIAogICAgYXN5bmMgZmV0Y2hVc2VySW5mbygpIHsKICAgICAgdHJ5IHsKICAgICAgICAvLyDov5nph4zlupTor6XosIPnlKjlkI7nq69BUEnojrflj5bnlKjmiLfkv6Hmga8KICAgICAgICAvLyDmmoLml7bkvb/nlKjmqKHmi5/mlbDmja4KICAgICAgICB0aGlzLnVzZXIgPSB7CiAgICAgICAgICBhdmF0YXI6ICdodHRwczovL2kwLmhkc2xiLmNvbS9iZnMvZmFjZS9tZW1iZXIvbm9mYWNlLmpwZycsCiAgICAgICAgICBuYW1lOiAnQmlsaWJpbGnnlKjmiLcnLAogICAgICAgICAgZGVzYzogJ0JpbGliaWxp55So5oi3562+5ZCNJywKICAgICAgICAgIHRvcFBob3RvOiAnJywKICAgICAgICAgIHZpcExhYmVsOiAnJywKICAgICAgICAgIHN0YXQ6IHsKICAgICAgICAgICAgZm9sbG93aW5nOiAxMDAsCiAgICAgICAgICAgIGZvbGxvd2VyOiA1MDAsCiAgICAgICAgICAgIGR5bmFtaWM6IDIwLAogICAgICAgICAgICBjb2luczogMTAKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W55So5oi35L+h5oGv5aSx6LSlOicsIGVycm9yKQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+iOt+WPlueUqOaIt+S/oeaBr+Wksei0pTogJyArIGVycm9yLm1lc3NhZ2UpCiAgICAgIH0KICAgIH0sCiAgICAKICAgIGFzeW5jIGV4aXRMb2dpbigpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBzdGF0dXMgPSBhd2FpdCBleGl0TG9naW4oKQogICAgICAgIGlmIChzdGF0dXMgPT09IDApIHsKICAgICAgICAgIHRoaXMuaXNMb2dpbiA9IGZhbHNlCiAgICAgICAgICB0aGlzLnVzZXIgPSB7CiAgICAgICAgICAgIGF2YXRhcjogJycsCiAgICAgICAgICAgIG5hbWU6ICcnLAogICAgICAgICAgICBkZXNjOiAnJywKICAgICAgICAgICAgdG9wUGhvdG86ICcnLAogICAgICAgICAgICB2aXBMYWJlbDogJycsCiAgICAgICAgICAgIHN0YXQ6IHsKICAgICAgICAgICAgICBmb2xsb3dpbmc6IDAsCiAgICAgICAgICAgICAgZm9sbG93ZXI6IDAsCiAgICAgICAgICAgICAgZHluYW1pYzogMCwKICAgICAgICAgICAgICBjb2luczogMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+mAgOWHuueZu+W9leaIkOWKnycpCiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+mAgOWHuueZu+W9leWksei0pTonLCBlcnJvcikKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfpgIDlh7rnmbvlvZXlpLHotKU6ICcgKyBlcnJvci5tZXNzYWdlKQogICAgICB9CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["BiliToolsQRCodeLogin.vue"],"names":[],"mappings":";AA6EA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BiliToolsQRCodeLogin.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"bili-tools-qrcode-login\">\n    <h2>Bilibili 二维码登录</h2>\n    \n    <div v-if=\"!isLogin\" class=\"login-section\">\n      <div class=\"qrcode-section\">\n        <h3>扫码登录</h3>\n        <div class=\"qrcode-container\">\n          <div\n            v-if=\"scanStatus === -2\"\n            class=\"loading-overlay\"\n          >\n            <div class=\"loading-spinner\"></div>\n            <span>加载中...</span>\n          </div>\n          <div\n            v-if=\"scanStatus === 86038 || scanStatus === 86090\"\n            class=\"refresh-overlay\"\n            @click=\"initScan\"\n          >\n            <i\n              class=\"refresh-icon\"\n              :class=\"{\n                'el-icon-refresh': scanStatus === 86038,\n                'el-icon-check': scanStatus === 86090,\n              }\"\n            ></i>\n            <span class=\"refresh-text\">{{\n              scanStatus === 86038 ? '二维码已过期\\n请点击刷新' : '扫码成功\\n请在手机上确认'\n            }}</span>\n          </div>\n          <canvas ref=\"qrcodeCanvas\" class=\"qrcode-canvas\"></canvas>\n        </div>\n        <span class=\"scan-tip\">请使用Bilibili手机客户端扫描二维码</span>\n      </div>\n    </div>\n    \n    <div v-else class=\"user-info-section\">\n      <div class=\"user-header\">\n        <div class=\"user-top-photo\">\n          <div class=\"placeholder-top-photo\"></div>\n        </div>\n        <div class=\"user-details\">\n          <div class=\"user-avatar\">\n            <img :src=\"user.avatar\" :alt=\"user.name\" />\n            <div\n              v-if=\"user.vipLabel\"\n              class=\"vip-badge\"\n            >\n              <span class=\"vip-text\">VIP</span>\n            </div>\n          </div>\n          <div class=\"user-info\">\n            <h1 class=\"user-name\">{{ user.name }}</h1>\n            <span class=\"user-desc\">{{ user.desc }}</span>\n          </div>\n          <div class=\"user-stats\">\n            <div\n              v-for=\"(value, key) in user.stat\"\n              :key=\"key\"\n              class=\"stat-item\"\n            >\n              <span class=\"stat-label\">{{ getStatLabel(key) }}</span>\n              <span class=\"stat-value\">{{ value }}</span>\n            </div>\n          </div>\n          <button class=\"logout-btn\" @click=\"exitLogin\">\n            <i class=\"el-icon-switch-button\"></i>\n            <span>退出登录</span>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { genQrcode, scanLogin, exitLogin } from '@/services/bilibiliLogin'\n\nexport default {\n  name: 'BiliToolsQRCodeLogin',\n  data() {\n    return {\n      isLogin: false,\n      scanStatus: -1, // -2: 加载中, -1: 初始化, 86101: 未扫码, 86090: 已扫描未确认, 86038: 二维码已失效, 0: 登录成功\n      user: {\n        avatar: '',\n        name: '',\n        desc: '',\n        topPhoto: '',\n        vipLabel: '',\n        stat: {\n          following: 0,\n          follower: 0,\n          dynamic: 0,\n          coins: 0\n        }\n      }\n    }\n  },\n  mounted() {\n    this.initScan()\n  },\n  methods: {\n    getStatLabel(key) {\n      const labels = {\n        following: '关注数',\n        follower: '粉丝数',\n        dynamic: '动态数',\n        coins: '硬币数'\n      }\n      return labels[key] || key\n    },\n    \n    async initScan() {\n      if (!this.$refs.qrcodeCanvas) return\n      \n      try {\n        this.scanStatus = -2 // 设置为加载状态\n        this.$refs.qrcodeCanvas.height = 300 // 重置canvas\n        \n        // 生成二维码\n        const key = await genQrcode(this.$refs.qrcodeCanvas)\n        this.scanStatus = -1 // 设置为初始状态\n        \n        // 开始轮询扫码状态\n        const status = await scanLogin(key, (code) => {\n          this.scanStatus = code\n        })\n        \n        // 注意：scanLogin在登录成功时会返回0并结束执行\n        if (status === 0) {\n          // 登录成功\n          this.scanStatus = 0\n          this.isLogin = true\n          this.fetchUserInfo()\n        } else if (status === 86038) {\n          // 二维码已失效\n          this.scanStatus = 86038\n        }\n      } catch (error) {\n        console.error('初始化扫码失败:', error)\n        this.$message.error('初始化扫码失败: ' + error.message)\n      }\n    },\n    \n    async fetchUserInfo() {\n      try {\n        // 这里应该调用后端API获取用户信息\n        // 暂时使用模拟数据\n        this.user = {\n          avatar: 'https://i0.hdslb.com/bfs/face/member/noface.jpg',\n          name: 'Bilibili用户',\n          desc: 'Bilibili用户签名',\n          topPhoto: '',\n          vipLabel: '',\n          stat: {\n            following: 100,\n            follower: 500,\n            dynamic: 20,\n            coins: 10\n          }\n        }\n      } catch (error) {\n        console.error('获取用户信息失败:', error)\n        this.$message.error('获取用户信息失败: ' + error.message)\n      }\n    },\n    \n    async exitLogin() {\n      try {\n        const status = await exitLogin()\n        if (status === 0) {\n          this.isLogin = false\n          this.user = {\n            avatar: '',\n            name: '',\n            desc: '',\n            topPhoto: '',\n            vipLabel: '',\n            stat: {\n              following: 0,\n              follower: 0,\n              dynamic: 0,\n              coins: 0\n            }\n          }\n          this.$message.success('退出登录成功')\n        }\n      } catch (error) {\n        console.error('退出登录失败:', error)\n        this.$message.error('退出登录失败: ' + error.message)\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.bili-tools-qrcode-login {\n  max-width: 90vw;\n  margin: 0 auto;\n  padding: 20px;\n}\n\n.login-section {\n  display: flex;\n  justify-content: center;\n  align-items: flex-start;\n  gap: 20px;\n}\n\n.qrcode-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 10px;\n}\n\n.qrcode-container {\n  position: relative;\n  display: flex;\n  width: 300px;\n  padding: 10px;\n  border-radius: 10px;\n  background-color: white;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n}\n\n.loading-overlay {\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 10px;\n  width: 300px;\n  height: 300px;\n  background-color: rgba(255, 255, 255, 0.9);\n  z-index: 2;\n}\n\n.loading-spinner {\n  width: 40px;\n  height: 40px;\n  border: 4px solid #f3f3f3;\n  border-top: 4px solid #00a1d6;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n.refresh-overlay {\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 10px;\n  width: 300px;\n  height: 300px;\n  background-color: rgba(255, 255, 255, 0.9);\n  cursor: pointer;\n  z-index: 2;\n  border-radius: 10px;\n}\n\n.refresh-icon {\n  font-size: 24px;\n  color: #00a1d6;\n}\n\n.refresh-text {\n  margin: 0;\n  text-align: center;\n  color: #666;\n  font-size: 14px;\n  white-space: pre-line;\n}\n\n.qrcode-canvas {\n  width: 300px;\n  height: 300px;\n}\n\n.scan-tip {\n  color: #999;\n  font-size: 14px;\n}\n\n.user-info-section {\n  width: 100%;\n}\n\n.user-header {\n  position: relative;\n}\n\n.placeholder-top-photo {\n  width: 100%;\n  height: 200px;\n  background: linear-gradient(45deg, #00a1d6, #00b5e5);\n  border-radius: 10px 10px 0 0;\n}\n\n.user-details {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 20px;\n  padding: 20px;\n  background-color: white;\n  border-radius: 0 0 10px 10px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n}\n\n.user-avatar {\n  position: relative;\n}\n\n.user-avatar img {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  border: 3px solid #fff;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.vip-badge {\n  position: absolute;\n  width: 30px;\n  height: 30px;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(45deg, #ff9800, #ff5722);\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.vip-text {\n  color: white;\n  font-size: 10px;\n  font-weight: bold;\n}\n\n.user-info {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 5px;\n}\n\n.user-name {\n  margin: 0;\n  font-size: 24px;\n  font-weight: bold;\n  color: #333;\n}\n\n.user-desc {\n  color: #999;\n  font-size: 14px;\n}\n\n.user-stats {\n  display: flex;\n  gap: 20px;\n}\n\n.stat-item {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.stat-label {\n  color: #999;\n  font-size: 12px;\n}\n\n.stat-value {\n  font-size: 16px;\n  font-weight: bold;\n  color: #333;\n}\n\n.logout-btn {\n  display: flex;\n  align-items: center;\n  gap: 5px;\n  padding: 10px 20px;\n  background-color: #00a1d6;\n  color: white;\n  border: none;\n  border-radius: 5px;\n  cursor: pointer;\n  font-size: 14px;\n}\n\n.logout-btn:hover {\n  background-color: #008cca;\n}\n\n.logout-btn i {\n  font-size: 16px;\n}\n</style>"]}]}