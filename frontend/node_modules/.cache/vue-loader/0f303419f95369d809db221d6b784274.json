{"remainingRequest":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tbw/work/btProject/reaction-cut/frontend/src/views/VideoDownload.vue?vue&type=style&index=0&id=12fc14d9&scoped=true&lang=css","dependencies":[{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/src/views/VideoDownload.vue","mtime":1762088097536},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/css-loader@3.6.0_webpack@5.102.1/node_modules/css-loader/dist/cjs.js","mtime":1762013131130},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1761026704430},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js","mtime":1762013131924},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/cache-loader@4.1.0_webpack@4.47.0/node_modules/cache-loader/dist/cjs.js","mtime":1761026713270},{"path":"/Users/tbw/work/btProject/reaction-cut/frontend/node_modules/.pnpm/vue-loader@15.11.1_@vue+compiler-sfc@3.5.22_cache-loader@4.1.0_webpack@4.47.0__css-load_f9e102e5cbb5fa5aa7d45569a28cebe6/node_modules/vue-loader/lib/index.js","mtime":1761026704427}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci52aWRlby1kb3dubG9hZCB7CiAgcGFkZGluZzogMjBweDsKfQoKLnNlYXJjaC1jYXJkIHsKICBtYXJnaW4tYm90dG9tOiAyMHB4Owp9CgoudmlkZW8taW5mby1jYXJkIHsKICBtYXJnaW4tYm90dG9tOiAyMHB4Owp9CgoudmlkZW8taGVhZGVyIHsKICBkaXNwbGF5OiBmbGV4OwogIG1hcmdpbi1ib3R0b206IDIwcHg7CiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlYmVlZjU7CiAgcGFkZGluZy1ib3R0b206IDIwcHg7Cn0KCi52aWRlby1jb3ZlciB7CiAgd2lkdGg6IDE2MHB4OwogIGhlaWdodDogMTAwcHg7CiAgbWFyZ2luLXJpZ2h0OiAyMHB4OwogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmN2ZhOwogIGJvcmRlci1yYWRpdXM6IDRweDsKICBvdmVyZmxvdzogaGlkZGVuOwp9CgouY292ZXItaW1nIHsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IDEwMCU7CiAgb2JqZWN0LWZpdDogY292ZXI7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIGRpc3BsYXk6IGJsb2NrOwp9CgoudmlkZW8tZGV0YWlscyB7CiAgZmxleDogMTsKfQoKLnZpZGVvLXRpdGxlIHsKICBmb250LXNpemU6IDE4cHg7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKfQoKLnZpZGVvLXN0YXRzIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtd3JhcDogd3JhcDsKICBtYXJnaW4tYm90dG9tOiAxMHB4Owp9Cgouc3RhdC1pdGVtIHsKICBtYXJnaW4tcmlnaHQ6IDE1cHg7CiAgZm9udC1zaXplOiAxMnB4OwogIGNvbG9yOiAjOTA5Mzk5Owp9CgoudmlkZW8tZGVzYyB7CiAgZm9udC1zaXplOiAxNHB4OwogIGNvbG9yOiAjNjA2MjY2OwogIGxpbmUtaGVpZ2h0OiAxLjU7CiAgbWF4LWhlaWdodDogNjBweDsKICBvdmVyZmxvdzogaGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwogIGRpc3BsYXk6IC13ZWJraXQtYm94OwogIC13ZWJraXQtbGluZS1jbGFtcDogMjsKICAtd2Via2l0LWJveC1vcmllbnQ6IHZlcnRpY2FsOwp9CgoudXBsb2FkZXItaW5mbyB7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIHdpZHRoOiA4MHB4Owp9CgoudXBsb2FkZXItYXZhdGFyIHsKICB3aWR0aDogNDBweDsKICBoZWlnaHQ6IDQwcHg7CiAgYm9yZGVyLXJhZGl1czogNTAlOwogIG1hcmdpbi1ib3R0b206IDVweDsKfQoKLnVwbG9hZGVyLW5hbWUgewogIGZvbnQtc2l6ZTogMTJweDsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwogIG92ZXJmbG93OiBoaWRkZW47CiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7Cn0KCi5wYXJ0cy1oZWFkZXIgewogIGRpc3BsYXk6IGZsZXg7CiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgbWFyZ2luLWJvdHRvbTogMTVweDsKfQoKLnBhcnRzLWFjdGlvbnMgewogIGRpc3BsYXk6IGZsZXg7CiAgZ2FwOiAxMHB4Owp9CgovKiDkuIvovb3orrDlvZXmoLflvI8gKi8KLmRvd25sb2FkLXRhYnMgewogIG1hcmdpbi10b3A6IDIwcHg7Cn0KCi5yZWNvcmQtdGFicyB7CiAgbWluLWhlaWdodDogNDAwcHg7Cn0KCi5kb3dubG9hZC1saXN0IHsKICBwYWRkaW5nOiAyMHB4Owp9CgouZG93bmxvYWQtaXRlbSB7CiAgbWFyZ2luLWJvdHRvbTogMTVweDsKfQoKLmRvd25sb2FkLWl0ZW0tY29udGVudCB7CiAgcGFkZGluZzogMTVweDsKfQoKLml0ZW0taGVhZGVyIHsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIG1hcmdpbi1ib3R0b206IDEwcHg7Cn0KCi5wYXJ0LXRpdGxlIHsKICBmb250LXNpemU6IDE2cHg7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgY29sb3I6ICMzMDMxMzM7Cn0KCi5pdGVtLWNvbmZpZyB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LXdyYXA6IHdyYXA7CiAgZ2FwOiAxNXB4OwogIG1hcmdpbi1ib3R0b206IDEwcHg7Cn0KCi5jb25maWctaXRlbSB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwp9CgouY29uZmlnLWxhYmVsIHsKICBmb250LXNpemU6IDEycHg7CiAgY29sb3I6ICM5MDkzOTk7CiAgbWFyZ2luLXJpZ2h0OiA1cHg7Cn0KCi5jb25maWctdmFsdWUgewogIGZvbnQtc2l6ZTogMTJweDsKICBjb2xvcjogIzYwNjI2NjsKfQoKLml0ZW0tcHJvZ3Jlc3MgewogIG1hcmdpbjogMTVweCAwOwp9CgouaXRlbS10aW1lIHsKICBmb250LXNpemU6IDEycHg7CiAgY29sb3I6ICM5MDkzOTk7Cn0KCi5uby1kYXRhIHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgY29sb3I6ICM5MDkzOTk7CiAgcGFkZGluZzogNTBweCAwOwp9Cg=="},{"version":3,"sources":["VideoDownload.vue"],"names":[],"mappings":";AAk2BA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"VideoDownload.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"video-download\">\n    <h2>视频下载</h2>\n    \n    <!-- 主Tabs -->\n    <el-tabs v-model=\"activeMainTab\" type=\"card\" @tab-click=\"handleMainTabClick\">\n      <!-- 视频下载Tab -->\n      <el-tab-pane label=\"视频下载\" name=\"videoDownload\">\n        <!-- 搜索区域 -->\n        <el-card class=\"search-card\">\n          <div slot=\"header\">\n            <span>搜索视频</span>\n          </div>\n          <el-row :gutter=\"20\">\n            <el-col :span=\"18\">\n              <el-input \n                v-model=\"searchInput\" \n                placeholder=\"请输入BV号或视频链接\"\n                size=\"large\"\n                @keyup.enter.native=\"searchVideo\"\n              >\n                <i slot=\"prefix\" class=\"el-input__icon el-icon-search\"></i>\n              </el-input>\n            </el-col>\n            <el-col :span=\"6\">\n              <el-button \n                type=\"primary\" \n                size=\"large\" \n                @click=\"searchVideo\"\n                :loading=\"searching\"\n                style=\"width: 100%\"\n              >\n                搜索\n              </el-button>\n            </el-col>\n          </el-row>\n        </el-card>\n        \n        <!-- 视频信息展示 -->\n        <el-card class=\"video-info-card\" v-if=\"videoInfo\">\n          <div class=\"video-header\">\n            <div class=\"video-cover\">\n              <img \n                :src=\"getProxyImageUrl(videoInfo.pic) || getDefaultCover()\" \n                alt=\"视频封面\" \n                class=\"cover-img\"\n                @error=\"handleCoverError\"\n              >\n            </div>\n            <div class=\"video-details\">\n              <div class=\"video-title\">{{ videoInfo.title }}</div>\n              <div class=\"video-stats\">\n                <span class=\"stat-item\">播放: {{ formatNumber(videoInfo.stat.view) }}</span>\n                <span class=\"stat-item\">弹幕: {{ formatNumber(videoInfo.stat.danmaku) }}</span>\n                <span class=\"stat-item\">评论: {{ formatNumber(videoInfo.stat.reply) }}</span>\n                <span class=\"stat-item\">收藏: {{ formatNumber(videoInfo.stat.favorite) }}</span>\n                <span class=\"stat-item\">投币: {{ formatNumber(videoInfo.stat.coin) }}</span>\n                <span class=\"stat-item\">点赞: {{ formatNumber(videoInfo.stat.like) }}</span>\n                <span class=\"stat-item\">分享: {{ formatNumber(videoInfo.stat.share) }}</span>\n              </div>\n              <div class=\"video-desc\">{{ videoInfo.desc }}</div>\n            </div>\n            <div class=\"uploader-info\">\n              <img \n                :src=\"getProxyImageUrl(videoInfo.owner.face) || getDefaultAvatar()\" \n                alt=\"UP主头像\" \n                class=\"uploader-avatar\"\n                @error=\"handleAvatarError\"\n              >\n              <div class=\"uploader-name\">{{ videoInfo.owner.name }}</div>\n            </div>\n          </div>\n          \n          <!-- 分P列表 -->\n          <div class=\"video-parts\">\n            <div class=\"parts-header\">\n              <div class=\"parts-title\">分P列表 (共{{ videoParts.length }}个)</div>\n              <div class=\"parts-actions\">\n                <el-button \n                  size=\"small\" \n                  @click=\"toggleSelectAll\"\n                >\n                  {{ selectedParts.length === videoParts.length ? '取消全选' : '全选' }}\n                </el-button>\n                <el-button \n                  type=\"primary\" \n                  size=\"small\" \n                  @click=\"showDownloadDialog\"\n                  :disabled=\"selectedParts.length === 0\"\n                >\n                  常规下载\n                </el-button>\n              </div>\n            </div>\n            \n            <el-table \n              :data=\"videoParts\" \n              style=\"width: 100%\" \n              @selection-change=\"handleSelectionChange\"\n              ref=\"multipleTable\"\n            >\n              <el-table-column type=\"selection\" width=\"55\"></el-table-column>\n              <el-table-column prop=\"part\" label=\"分P标题\"></el-table-column>\n              <el-table-column prop=\"duration\" label=\"时长\" width=\"120\">\n                <template slot-scope=\"scope\">\n                  {{ formatDuration(scope.row.duration) }}\n                </template>\n              </el-table-column>\n            </el-table>\n          </div>\n        </el-card>\n        \n        <!-- 下载配置弹窗 -->\n        <el-dialog\n          title=\"下载配置\"\n          :visible.sync=\"downloadDialogVisible\"\n          width=\"500px\"\n        >\n          <el-form :model=\"downloadConfig\" label-width=\"100px\">\n            <el-form-item label=\"下载名称\">\n              <el-input \n                v-model=\"downloadConfig.downloadName\" \n                placeholder=\"请输入下载文件夹名称\"\n              ></el-input>\n              <div style=\"font-size: 12px; color: #999; margin-top: 5px;\">\n                用于指定下载视频的主文件夹名称\n              </div>\n            </el-form-item>\n            <el-form-item label=\"分辨率\">\n              <el-select v-model=\"downloadConfig.resolution\" placeholder=\"请选择分辨率\">\n                <el-option \n                  v-for=\"resolution in availableResolutions\" \n                  :key=\"resolution.value\" \n                  :label=\"resolution.label\" \n                  :value=\"resolution.value\">\n                </el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"编码格式\">\n              <el-select v-model=\"downloadConfig.codec\" placeholder=\"请选择编码格式\">\n                <el-option \n                  v-for=\"codec in availableCodecs\" \n                  :key=\"codec.value\" \n                  :label=\"codec.label\" \n                  :value=\"codec.value\">\n                </el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"流媒体格式\">\n              <el-select v-model=\"downloadConfig.format\" placeholder=\"请选择格式\">\n                <el-option \n                  v-for=\"format in availableFormats\" \n                  :key=\"format.value\" \n                  :label=\"format.label\" \n                  :value=\"format.value\">\n                </el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"下载内容\">\n              <el-select v-model=\"downloadConfig.content\" placeholder=\"请选择下载内容\">\n                <el-option label=\"音视频\" value=\"audio_video\"></el-option>\n                <el-option label=\"仅视频\" value=\"video_only\"></el-option>\n                <el-option label=\"仅音频\" value=\"audio_only\"></el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"下载路径\">\n              <el-input v-model=\"downloadConfig.downloadPath\" placeholder=\"请输入下载路径\">\n              </el-input>\n              <div style=\"font-size: 12px; color: #999; margin-top: 5px;\">\n                默认路径: /Users/tbw/Reaction/cut\n              </div>\n            </el-form-item>\n          </el-form>\n          <span slot=\"footer\" class=\"dialog-footer\">\n            <el-button @click=\"downloadDialogVisible = false\">取 消</el-button>\n            <el-button type=\"primary\" @click=\"startDownload\">确 定</el-button>\n          </span>\n        </el-dialog>\n      </el-tab-pane>\n      \n      <!-- 下载记录Tab -->\n      <el-tab-pane label=\"下载记录\" name=\"downloadRecord\">\n        <el-tabs v-model=\"activeRecordTab\" type=\"card\" @tab-click=\"handleRecordTabClick\">\n          <el-tab-pane label=\"待下载\" name=\"pending\">\n            <div class=\"download-list\">\n              <el-card \n                v-for=\"item in pendingDownloads\" \n                :key=\"item.id\" \n                class=\"download-item\"\n              >\n                <div class=\"download-item-content\">\n                  <div class=\"item-header\">\n                    <div class=\"part-title\">{{ item.partTitle || '未知分P' }}</div>\n                    <div class=\"item-actions\">\n                      <el-button \n                        type=\"danger\" \n                        size=\"mini\" \n                        icon=\"el-icon-delete\" \n                        @click=\"deleteDownloadRecord(item.id)\"\n                      >\n                        删除\n                      </el-button>\n                    </div>\n                  </div>\n                  <div class=\"item-config\">\n                    <div class=\"config-item\">\n                      <span class=\"config-label\">分辨率:</span>\n                      <span class=\"config-value\">{{ item.resolution || '未知' }}</span>\n                    </div>\n                    <div class=\"config-item\">\n                      <span class=\"config-label\">编码格式:</span>\n                      <span class=\"config-value\">{{ item.codec || '未知' }}</span>\n                    </div>\n                    <div class=\"config-item\">\n                      <span class=\"config-label\">流媒体格式:</span>\n                      <span class=\"config-value\">{{ item.format || '未知' }}</span>\n                    </div>\n                  </div>\n                  <div class=\"item-progress\">\n                    <el-progress :percentage=\"item.progress || 0\"></el-progress>\n                  </div>\n                  <div class=\"item-time\">\n                    创建时间: {{ formatTime(item.createTime) }}\n                  </div>\n                </div>\n              </el-card>\n              <div v-if=\"pendingDownloads.length === 0\" class=\"no-data\">\n                暂无待下载任务\n              </div>\n            </div>\n          </el-tab-pane>\n          <el-tab-pane label=\"下载中\" name=\"downloading\">\n            <div class=\"download-list\">\n              <el-card \n                v-for=\"item in downloadingDownloads\" \n                :key=\"item.id\" \n                class=\"download-item\"\n              >\n                <div class=\"download-item-content\">\n                  <div class=\"item-header\">\n                    <div class=\"part-title\">{{ item.partTitle || '未知分P' }}</div>\n                    <div class=\"item-actions\">\n                      <el-button \n                        type=\"danger\" \n                        size=\"mini\" \n                        icon=\"el-icon-delete\" \n                        @click=\"deleteDownloadRecord(item.id)\"\n                      >\n                        删除\n                      </el-button>\n                    </div>\n                  </div>\n                  <div class=\"item-config\">\n                    <div class=\"config-item\">\n                      <span class=\"config-label\">分辨率:</span>\n                      <span class=\"config-value\">{{ item.resolution || '未知' }}</span>\n                    </div>\n                    <div class=\"config-item\">\n                      <span class=\"config-label\">编码格式:</span>\n                      <span class=\"config-value\">{{ item.codec || '未知' }}</span>\n                    </div>\n                    <div class=\"config-item\">\n                      <span class=\"config-label\">流媒体格式:</span>\n                      <span class=\"config-value\">{{ item.format || '未知' }}</span>\n                    </div>\n                  </div>\n                  <div class=\"item-progress\">\n                    <el-progress :percentage=\"item.progress || 0\"></el-progress>\n                  </div>\n                  <div class=\"item-time\">\n                    创建时间: {{ formatTime(item.createTime) }}\n                  </div>\n                </div>\n              </el-card>\n              <div v-if=\"downloadingDownloads.length === 0\" class=\"no-data\">\n                暂无下载中任务\n              </div>\n            </div>\n          </el-tab-pane>\n          <el-tab-pane label=\"已下载\" name=\"completed\">\n            <div class=\"download-list\">\n              <el-card \n                v-for=\"item in completedDownloads\" \n                :key=\"item.id\" \n                class=\"download-item\"\n              >\n                <div class=\"download-item-content\">\n                  <div class=\"item-header\">\n                    <div class=\"part-title\">{{ item.partTitle || '未知分P' }}</div>\n                    <div class=\"item-actions\">\n                      <el-button \n                        type=\"danger\" \n                        size=\"mini\" \n                        icon=\"el-icon-delete\" \n                        @click=\"deleteDownloadRecord(item.id)\"\n                      >\n                        删除\n                      </el-button>\n                    </div>\n                  </div>\n                  <div class=\"item-config\">\n                    <div class=\"config-item\">\n                      <span class=\"config-label\">分辨率:</span>\n                      <span class=\"config-value\">{{ item.resolution || '未知' }}</span>\n                    </div>\n                    <div class=\"config-item\">\n                      <span class=\"config-label\">编码格式:</span>\n                      <span class=\"config-value\">{{ item.codec || '未知' }}</span>\n                    </div>\n                    <div class=\"config-item\">\n                      <span class=\"config-label\">流媒体格式:</span>\n                      <span class=\"config-value\">{{ item.format || '未知' }}</span>\n                    </div>\n                  </div>\n                  <div class=\"item-progress\">\n                    <el-progress \n                      :percentage=\"item.progress || 0\" \n                      :status=\"item.status === 2 ? 'success' : 'exception'\"\n                    ></el-progress>\n                  </div>\n                  <div class=\"item-time\">\n                    创建时间: {{ formatTime(item.createTime) }}\n                  </div>\n                </div>\n              </el-card>\n              <div v-if=\"completedDownloads.length === 0\" class=\"no-data\">\n                暂无已完成下载任务\n              </div>\n            </div>\n          </el-tab-pane>\n        </el-tabs>\n      </el-tab-pane>\n    </el-tabs>\n  </div>\n</template>\n\n<script>\nimport { \n  downloadVideo, \n  getDownloadStatus, \n  getPendingDownloads, \n  getDownloadingDownloads, \n  getCompletedDownloads,\n  deleteDownloadRecord\n} from '@/api/video'\nimport { getVideoDetail, getVideoDetailByAid, getVideoPlayUrl } from '@/api/video'\n\nexport default {\n  name: 'VideoDownload',\n  data() {\n    return {\n      searchInput: '',\n      searching: false,\n      videoInfo: null,\n      videoParts: [],\n      selectedParts: [],\n      downloadDialogVisible: false,\n      downloadConfig: {\n        downloadName: '', // 新增下载名称配置\n        resolution: '',\n        codec: '',\n        format: '',\n        content: 'audio_video',\n        downloadPath: '/Users/tbw/Reaction/cut' // 设置默认下载路径\n      },\n      availableResolutions: [],\n      availableCodecs: [],\n      availableFormats: [],\n      downloadTaskId: null,\n      pollingTimer: null,\n      // Tabs相关数据\n      activeMainTab: 'videoDownload',\n      activeRecordTab: 'pending',\n      pendingDownloads: [],\n      downloadingDownloads: [],\n      completedDownloads: []\n    }\n  },\n  mounted() {\n    // 组件挂载后检查refs\n    this.$nextTick(() => {\n      console.log('组件挂载完成，检查refs:', this.$refs);\n    });\n    \n    // 加载下载记录\n    this.loadDownloadRecords();\n  },\n  methods: {\n    // 搜索视频\n    async searchVideo() {\n      if (!this.searchInput) {\n        this.$message.warning('请输入BV号或视频链接')\n        return\n      }\n      \n      this.searching = true\n      try {\n        // 从输入中提取视频ID\n        const videoId = this.extractVideoIdFromInput(this.searchInput)\n        \n        let response\n        if (videoId.bvid) {\n          response = await getVideoDetail(videoId.bvid)\n        } else if (videoId.aid) {\n          response = await getVideoDetailByAid(videoId.aid)\n        } else {\n          throw new Error('无法识别的视频ID格式')\n        }\n        \n        if (response.code === 0) {\n          this.videoInfo = response.data\n          // 处理分P列表\n          if (this.videoInfo.pages && this.videoInfo.pages.length > 0) {\n            this.videoParts = this.videoInfo.pages.map((page, index) => ({\n              id: page.cid,\n              part: page.part || `Part ${index + 1}`,\n              duration: page.duration || 0\n            }))\n          } else {\n            // 如果没有分P信息，创建一个默认分P\n            this.videoParts = [{\n              id: this.videoInfo.cid || 0,\n              part: this.videoInfo.title || '默认分P',\n              duration: this.videoInfo.duration || 0\n            }]\n          }\n          \n          // 清空已选择的分P\n          this.selectedParts = []\n          this.$refs.multipleTable && this.$refs.multipleTable.clearSelection()\n          \n          // 解析可用的下载配置\n          this.parseAvailableResolutions(response.data)\n          this.parseAvailableCodecs(response.data)\n          this.parseAvailableFormats(response.data)\n          \n          // 设置默认下载配置（仅当还没有设置默认值时）\n          if (!this.downloadConfig.resolution && this.availableResolutions.length > 0) {\n            this.downloadConfig.resolution = this.availableResolutions[0].value\n          }\n          if (!this.downloadConfig.codec && this.availableCodecs.length > 0) {\n            this.downloadConfig.codec = this.availableCodecs[0].value\n          }\n          if (!this.downloadConfig.format && this.availableFormats.length > 0) {\n            this.downloadConfig.format = this.availableFormats[0].value\n          }\n          \n          // 设置默认下载名称为视频标题\n          if (this.videoInfo.title) {\n            this.downloadConfig.downloadName = this.videoInfo.title\n          }\n        } else {\n          this.$message.error(response.message)\n        }\n      } catch (error) {\n        this.$message.error('搜索失败: ' + error.message)\n      } finally {\n        this.searching = false\n      }\n    },\n    \n    // 获取代理图片URL\n    getProxyImageUrl(imageUrl) {\n      if (!imageUrl) return null\n      // 使用后端代理接口加载图片\n      return `/api/video/proxy-image?imageUrl=${encodeURIComponent(imageUrl)}`\n    },\n    \n    // 从输入中提取视频ID\n    extractVideoIdFromInput(input) {\n      // BV号格式\n      const bvMatch = input.match(/BV([A-Za-z0-9]+)/)\n      if (bvMatch && bvMatch[1]) {\n        return { bvid: 'BV' + bvMatch[1] }\n      }\n      \n      // 如果是BV号格式，直接返回\n      if (/^BV[A-Za-z0-9]+$/.test(input)) {\n        return { bvid: input }\n      }\n      \n      // aid格式\n      const avMatch = input.match(/av(\\d+)/) || input.match(/aid=(\\d+)/)\n      if (avMatch && avMatch[1]) {\n        return { aid: parseInt(avMatch[1]) }\n      }\n      \n      // 如果是纯数字，当作aid处理\n      if (/^\\d+$/.test(input)) {\n        return { aid: parseInt(input) }\n      }\n      \n      return { bvid: null, aid: null }\n    },\n    \n    // 解析可用的分辨率\n    parseAvailableResolutions(data) {\n      this.availableResolutions = []\n      \n      // 从DASH视频流中获取分辨率信息\n      if (data.dash && data.dash.video && data.dash.video.length > 0) {\n        const uniqueResolutions = new Set()\n        data.dash.video.forEach(video => {\n          if (video.id) {\n            uniqueResolutions.add(video.id)\n          }\n        })\n        \n        // 将唯一分辨率转换为选项\n        Array.from(uniqueResolutions).sort((a, b) => b - a).forEach(id => {\n          let label = id + 'P'\n          // 根据常见的分辨率ID映射标签\n          switch (id) {\n            case 16:\n              label = '360P 流畅'\n              break\n            case 32:\n              label = '480P 清晰'\n              break\n            case 64:\n              label = '720P 高清'\n              break\n            case 74:\n              label = '720P60 高清'\n              break\n            case 80:\n              label = '1080P 高清'\n              break\n            case 112:\n              label = '1080P+ 高码率'\n              break\n            case 116:\n              label = '1080P60 高帧率'\n              break\n            case 120:\n              label = '4K 超清'\n              break\n            case 125:\n              label = 'HDR 真彩色'\n              break\n            case 126:\n              label = '杜比视界'\n              break\n            case 127:\n              label = '8K 超高清'\n              break\n          }\n          \n          this.availableResolutions.push({\n            value: id.toString(),\n            label: label\n          })\n        })\n      }\n      \n      // 如果仍然没有分辨率信息，设置默认值\n      if (this.availableResolutions.length === 0) {\n        this.availableResolutions = [\n          { value: '64', label: '720P 高清' },\n          { value: '80', label: '1080P 高清' },\n          { value: '112', label: '1080P+ 高码率' }\n        ]\n      }\n    },\n    \n    // 解析可用的编码格式\n    parseAvailableCodecs(data) {\n      this.availableCodecs = []\n      \n      // 从DASH视频流中获取编码格式信息\n      if (data.dash && data.dash.video && data.dash.video.length > 0) {\n        const uniqueCodecs = new Map()\n        data.dash.video.forEach(video => {\n          if (video.codecs) {\n            // 根据codecs值映射到编码格式标签\n            let label = video.codecs\n            if (video.codecs.includes('avc1')) {\n              label = 'H.264'\n            } else if (video.codecs.includes('hev1') || video.codecs.includes('hvc1')) {\n              label = 'H.265'\n            } else if (video.codecs.includes('vp09') || video.codecs.includes('vp9')) {\n              label = 'VP9'\n            } else if (video.codecs.includes('av01')) {\n              label = 'AV1'\n            }\n            \n            // 使用Map确保唯一性，避免重复\n            // 修复：直接使用video.codecs作为键\n            const key = video.codecs\n            uniqueCodecs.set(key, {\n              value: video.codecs,\n              label: label\n            })\n          }\n        })\n        \n        this.availableCodecs = Array.from(uniqueCodecs.values())\n      }\n      \n      // 如果没有编码格式信息，设置默认值\n      if (this.availableCodecs.length === 0) {\n        this.availableCodecs = [\n          { value: 'h264', label: 'H.264' },\n          { value: 'h265', label: 'H.265' },\n          { value: 'vp9', label: 'VP9' }\n        ]\n      }\n    },\n    \n    // 解析可用的流媒体格式\n    parseAvailableFormats(data) {\n      this.availableFormats = []\n      \n      // 根据返回的数据判断支持的格式\n      if (data.dash) {\n        this.availableFormats.push({ value: 'dash', label: 'DASH' })\n      }\n      \n      if (data.durl) {\n        this.availableFormats.push({ value: 'mp4', label: 'MP4' })\n      }\n      \n      // 如果没有格式信息，设置默认值\n      if (this.availableFormats.length === 0) {\n        this.availableFormats = [\n          { value: 'dash', label: 'DASH' },\n          { value: 'mp4', label: 'MP4' }\n        ]\n      }\n    },\n    \n    // 设置默认下载配置\n    setDefaultDownloadConfigs() {\n      this.availableResolutions = [\n        { value: '64', label: '720P 高清' },\n        { value: '80', label: '1080P 高清' },\n        { value: '112', label: '1080P+ 高码率' }\n      ]\n      \n      this.availableCodecs = [\n        { value: 'h264', label: 'H.264' },\n        { value: 'h265', label: 'H.265' },\n        { value: 'vp9', label: 'VP9' }\n      ]\n      \n      this.availableFormats = [\n        { value: 'dash', label: 'DASH' },\n        { value: 'mp4', label: 'MP4' }\n      ]\n      \n      // 设置默认值\n      this.downloadConfig.resolution = '64'\n      this.downloadConfig.codec = 'h264'\n      this.downloadConfig.format = 'dash'\n    },\n    \n    // 处理选择变化\n    handleSelectionChange(selection) {\n      this.selectedParts = selection\n    },\n    \n    // 全选/取消全选\n    toggleSelectAll() {\n      if (this.selectedParts.length === this.videoParts.length) {\n        // 取消全选\n        this.$refs.multipleTable.clearSelection()\n      } else {\n        // 全选\n        this.videoParts.forEach(row => {\n          this.$refs.multipleTable.toggleRowSelection(row, true)\n        })\n      }\n    },\n    \n    // 显示下载对话框\n    showDownloadDialog() {\n      if (this.selectedParts.length === 0) {\n        this.$message.warning('请至少选择一个分P')\n        return\n      }\n      this.downloadDialogVisible = true\n      \n      // 确保DOM更新后再检查refs\n      this.$nextTick(() => {\n        console.log('对话框打开后检查refs:', this.$refs);\n      });\n    },\n    \n    // 开始下载\n    async startDownload() {\n      try {\n        // 构造下载参数\n        const downloadParams = {\n          videoUrl: `https://www.bilibili.com/video/${this.videoInfo.bvid}`,\n          parts: this.selectedParts.map(part => ({\n            cid: part.id,\n            title: part.part\n          })),\n          config: this.downloadConfig\n        }\n        \n        // 调用下载API\n        const response = await downloadVideo(downloadParams)\n        if (response.code === 0) {\n          this.$message.success('下载任务已创建')\n          this.downloadTaskId = response.data\n          this.downloadDialogVisible = false\n          \n          // 重新加载下载记录\n          this.loadDownloadRecords();\n        } else {\n          this.$message.error(response.message)\n        }\n      } catch (error) {\n        this.$message.error('下载失败: ' + error.message)\n      }\n    },\n    \n    // 格式化数字\n    formatNumber(num) {\n      if (num >= 10000) {\n        return (num / 10000).toFixed(1) + '万'\n      }\n      return num\n    },\n    \n    // 格式化时长\n    formatDuration(seconds) {\n      const hours = Math.floor(seconds / 3600)\n      const minutes = Math.floor((seconds % 3600) / 60)\n      const secs = seconds % 60\n      \n      if (hours > 0) {\n        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`\n      } else {\n        return `${minutes}:${secs.toString().padStart(2, '0')}`\n      }\n    },\n    \n    // 获取默认封面\n    getDefaultCover() {\n      return 'https://i0.hdslb.com/bfs/archive/5242750857121e05146d5d1b5574913bad4410f7.jpg'\n    },\n    \n    // 获取默认头像\n    getDefaultAvatar() {\n      return 'https://i0.hdslb.com/bfs/face/member/noface.jpg'\n    },\n    \n    // 处理封面加载错误\n    handleCoverError(e) {\n      e.target.src = this.getDefaultCover()\n    },\n    \n    // 处理头像加载错误\n    handleAvatarError(e) {\n      e.target.src = this.getDefaultAvatar()\n    },\n    \n    // 格式化时间\n    formatTime(time) {\n      if (!time) return ''\n      return new Date(time).toLocaleString('zh-CN')\n    },\n    \n    // 加载下载记录\n    async loadDownloadRecords() {\n      try {\n        // 加载待下载任务\n        const pendingResponse = await getPendingDownloads()\n        if (pendingResponse.code === 0) {\n          this.pendingDownloads = pendingResponse.data || []\n        }\n        \n        // 加载下载中任务\n        const downloadingResponse = await getDownloadingDownloads()\n        if (downloadingResponse.code === 0) {\n          this.downloadingDownloads = downloadingResponse.data || []\n        }\n        \n        // 加载已完成任务\n        const completedResponse = await getCompletedDownloads()\n        if (completedResponse.code === 0) {\n          this.completedDownloads = completedResponse.data || []\n        }\n      } catch (error) {\n        console.error('加载下载记录失败:', error)\n      }\n    },\n    \n    // 删除下载记录\n    async deleteDownloadRecord(taskId) {\n      try {\n        await deleteDownloadRecord(taskId)\n        this.$message.success('删除成功')\n        // 重新加载下载记录\n        this.loadDownloadRecords()\n      } catch (error) {\n        this.$message.error('删除失败: ' + error.message)\n      }\n    },\n    \n    // 处理主标签页点击\n    handleMainTabClick(tab) {\n      if (tab.name === 'downloadRecord') {\n        // 切换到下载记录标签页时，刷新数据\n        this.loadDownloadRecords()\n      }\n    },\n    \n    // 处理记录标签页点击\n    handleRecordTabClick(tab) {\n      // 每次切换记录标签页时都刷新对应的数据\n      switch (tab.name) {\n        case 'pending':\n          this.loadPendingDownloads()\n          break\n        case 'downloading':\n          this.loadDownloadingDownloads()\n          break\n        case 'completed':\n          this.loadCompletedDownloads()\n          break\n      }\n    },\n    \n    // 加载待下载任务\n    async loadPendingDownloads() {\n      try {\n        const response = await getPendingDownloads()\n        if (response.code === 0) {\n          this.pendingDownloads = response.data || []\n        }\n      } catch (error) {\n        console.error('加载待下载任务失败:', error)\n      }\n    },\n    \n    // 加载下载中任务\n    async loadDownloadingDownloads() {\n      try {\n        const response = await getDownloadingDownloads()\n        if (response.code === 0) {\n          this.downloadingDownloads = response.data || []\n        }\n      } catch (error) {\n        console.error('加载下载中任务失败:', error)\n      }\n    },\n    \n    // 加载已完成任务\n    async loadCompletedDownloads() {\n      try {\n        const response = await getCompletedDownloads()\n        if (response.code === 0) {\n          this.completedDownloads = response.data || []\n        }\n      } catch (error) {\n        console.error('加载已完成任务失败:', error)\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.video-download {\n  padding: 20px;\n}\n\n.search-card {\n  margin-bottom: 20px;\n}\n\n.video-info-card {\n  margin-bottom: 20px;\n}\n\n.video-header {\n  display: flex;\n  margin-bottom: 20px;\n  border-bottom: 1px solid #ebeef5;\n  padding-bottom: 20px;\n}\n\n.video-cover {\n  width: 160px;\n  height: 100px;\n  margin-right: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: #f5f7fa;\n  border-radius: 4px;\n  overflow: hidden;\n}\n\n.cover-img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  border-radius: 4px;\n  display: block;\n}\n\n.video-details {\n  flex: 1;\n}\n\n.video-title {\n  font-size: 18px;\n  font-weight: bold;\n  margin-bottom: 10px;\n}\n\n.video-stats {\n  display: flex;\n  flex-wrap: wrap;\n  margin-bottom: 10px;\n}\n\n.stat-item {\n  margin-right: 15px;\n  font-size: 12px;\n  color: #909399;\n}\n\n.video-desc {\n  font-size: 14px;\n  color: #606266;\n  line-height: 1.5;\n  max-height: 60px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n\n.uploader-info {\n  text-align: center;\n  width: 80px;\n}\n\n.uploader-avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  margin-bottom: 5px;\n}\n\n.uploader-name {\n  font-size: 12px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.parts-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 15px;\n}\n\n.parts-actions {\n  display: flex;\n  gap: 10px;\n}\n\n/* 下载记录样式 */\n.download-tabs {\n  margin-top: 20px;\n}\n\n.record-tabs {\n  min-height: 400px;\n}\n\n.download-list {\n  padding: 20px;\n}\n\n.download-item {\n  margin-bottom: 15px;\n}\n\n.download-item-content {\n  padding: 15px;\n}\n\n.item-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.part-title {\n  font-size: 16px;\n  font-weight: bold;\n  color: #303133;\n}\n\n.item-config {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 15px;\n  margin-bottom: 10px;\n}\n\n.config-item {\n  display: flex;\n  align-items: center;\n}\n\n.config-label {\n  font-size: 12px;\n  color: #909399;\n  margin-right: 5px;\n}\n\n.config-value {\n  font-size: 12px;\n  color: #606266;\n}\n\n.item-progress {\n  margin: 15px 0;\n}\n\n.item-time {\n  font-size: 12px;\n  color: #909399;\n}\n\n.no-data {\n  text-align: center;\n  color: #909399;\n  padding: 50px 0;\n}\n</style>"]}]}